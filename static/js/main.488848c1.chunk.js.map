{"version":3,"sources":["lib/threejs/DataPoint.js","lib/ActionUtilities.js","lib/threejs/ProgressBar.js","lib/threejs/FluxArrow.js","lib/threejs/SceneManager.js","components/ThreeContainer.js","lib/threejs/threeEntryPoint.js","lib/FileUtilities.js","components/FileInput.js","lib/threejs/PlotData.js","lib/LocalStorage.js","components/Navigation.js","components/SavedPlot.js","components/StorageList.js","lib/threejs/DataContext.js","App.js","registerServiceWorker.js","index.js"],"names":["DataPoint","index","previousState","arguments","length","undefined","Object","classCallCheck","this","tinycolor","require","isState","dataIndex","labelText","baseColor","radius","shadowMargin","shadowPushBack","textPullForward","shadow","geometry","THREE","mesh","material","color","object","position","set","scale","withinCircle","x","y","pos","within","Math","sqrt","adjustScale","newRadius","newScale","appendText","font","text","xpos","ypos","size","height","curveSegments","bevelEnabled","bevelThickness","bevelSize","bevelSegments","textMesh","moveText","rotation","PI","changeTextSize","newX","newY","box","setFromObject","max","min","moveIndexText","indexTextMesh","setPosition","z","changeIndexTextSize","transformColor","colorObject","r","g","b","toHexString","changeColor","toString","lightenColor","percent","lighten","darkenColor","darken","showIndex","update","ActionUtilities","ms","Promise","resolve","setTimeout","ProgressBar","scene","fontResource","yPos","stepLength","bar","progress","start","stop","progressLength","add","updateProgress","step","timeInfo","remove","showTitle","titleTextMesh","withinBar","getStep","clickedPos","round","setSteps","numOfSteps","getBar","FluxArrow","arrowInfo","legacySaveIndex","arrowLength","dataPointRadius","arrowWidth","calculateLength","distance","point2","point1","calculateDir","calculatePos","adjust","dir","shiftAmount","shift","normalize","newColor","updatePos","to","from","setLength","setDirection","len","delete","origLength","SceneManager","canvas","data","actionUtil","origin","screenDimensions","width","origRadius","paused","stepInc","stepDelay","valueMax","fluxMax","skipSteps","progressBar","editMode","halfQuantity","halfFlux","mouseDown","dataPointToMove","userSelectedDataPoint","arrowMode","arrowPoints","controls","generateCompartments","animationData","alert","dataPoints","rect","getBoundingClientRect","spaceBetween","i","xPos","label","labels","addDataPoint","showIndices","generateFluxArrows","arrows","fluxData","fluxOriginLabels","fluxDestinationLabels","j","element","toLowerCase","trim","addArrow","seekHelp","window","open","location","href","changeStep","startStepping","startAnimation","pauseAnimation","resetAnimation","applyStep","addPoint","labelMode","prompt","deletePoint","dataPoint","splice","updateArrows","deleteDataPoint","compIndex","load","fontLoadingComplete","addEventListener","evt","checkWithinRange","mousePos","getMousePos","newMousePos","canvasToThreePos","background","buildScene","renderer","_ref","antialias","alpha","DPR","devicePixelRatio","setPixelRatio","setSize","gammaInput","gammaOutput","buildRender","camera","_ref2","lookAt","buildCamera","datGui","gui","dat","autoPlace","document","getElementById","appendChild","domElement","id","name","folder","addFolder","onChange","newValue","editFolder","show","revealIndices","listen","onFinishChange","point","changeAllRadius","addColor","buildInterpretationFolder","buildGUI","reloadScene","traverse","child","push","clearScene","hydratedPoints","c","forEach","oldPoint","savedData","geometries","restoreDataPoint","reloadDataPoints","hydratedArrows","legacyArrowIndex","oldArrow","legacyIndex","arrow","restoreArrow","reloadArrows","buildProgressBar","updateDisplay","selected","isDataLoaded","clickedStep","clientX","left","clientY","top","dataLoaded","_startStepping","apply","asyncToGenerator","regenerator_default","a","mark","_callee","singleStep","_args","wrap","_context","prev","next","stepForward","_stepForward","_callee2","_args2","_context2","hasNextStep","sleep","changePercent","diff","colorPoints","pointIndex1","pointIndex2","deletedDataPoint","index1","index2","onFluxLoad","onLoad","registerCallback","render","ThreeContainer","props","_this","possibleConstructorReturn","getPrototypeOf","call","dataContext","container","createElement","scrollWidth","scrollHeight","createCanvas","sceneManager","requestAnimationFrame","threeEntryPoint","threeRootElement","_this2","react_default","className","ref","Component","FileUtilities","xlsxFile","onComplete","reader","FileReader","readAsBinaryString","onload","csvSheetStrings","transformXLXSIntoCsvStrings","result","parseSingleCSV","file","readAsText","JSON","parse","binaryContents","XLSX","csvStrings","workbook","read","type","SheetNames","utils","sheet_to_csv","Sheets","csvString","ch","numOfRows","numOfColumns","charAt","Array","rows","split","FileInput","title","processUpload","bind","assertThisInitialized","state","callback","onDone","accept","plot","isPlot","files","e","readPlots","target","readXLSX","fileUtil","processPlotsData","dataString","hasNoFiles","processXLSXIntoCSV","FormGroup_default","ControlLabel_default","htmlFor","style","cursor","FormControl_default","input","fileInput","display","NavItem","PlotData","LocalStorage","modelName","model","newModelTemplate","loadModelsFromDefaultContainer","models","saveToStore","catch","key","value","failureMsg","localforage","setItem","stringify","String","t0","getItem","substring","_context3","addition","modelId","hasOwnProperty","versions","newModelVersion","reducedList","fetchFromStore","dataArray","Navigation","IController","uploadPoints","uploadDataPoints","uploadFlux","uploadFluxData","toast","POSITION","TOP_LEFT","localStorage","blobData","Blob","textFile","URL","createObjectURL","downloadAnchorNode","setAttribute","body","click","injectDataPointList","injectFluxList","confirm","writeToLocalStorage","reload","preventRedirect","preventDefault","Navbar_default","inverse","Header","Brand","Form_default","inline","FileInput_FileInput","onClick","uploadModels","downloadLocalStorage","lib","autoClose","SavedPlot","param","dataCapsule","StorageList","parent","entries","handleClick","addToLocal","removeFromLocal","loadSaves","createButtonEntry","createEntryName","createGrid","activeModelName","capsule","currentPlot","isActive","save","Button_default","applyName","SavedPlot_SavedPlot","_this3","s","resp","solictStorageName","addNewModelToLocal","forceUpdate","removeFromStorage","success","extension","updateStorage","loadFromStorage","ThreeController","setState","_this4","DataContext","context","plot_id","callbacks","assign","callObservers","loadPlot","json","xlsxData","instance","isNaN","loadFluxData","App","resetDataAnimation","fetchSaves","saves","console","log","currentContext","Grid_default","fluid","Row_default","components_Navigation","Col_default","sm","md","StorageList_StorageList","Image_default","src","ThreeContainer_ThreeContainer","isLocalhost","Boolean","hostname","match","registerValidSW","swUrl","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","controller","error","ReactDOM","src_App","process","concat","fetch","response","status","headers","get","indexOf","ready","unregister","checkValidServiceWorker","registerServiceWorker"],"mappings":"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","file":"static/js/main.488848c1.chunk.js","sourcesContent":["/* Imported From: https://itnext.io/how-to-use-plain-three-js-in-your-react-apps-417a79d926e0 */\r\nimport * as THREE from 'three'\r\n\r\nclass DataPoint {\r\n\r\n    constructor(index, previousState = null) {\r\n        var tinycolor = require('tinycolor2');\r\n        const origRadius = 40;\r\n\r\n        let isState = !!previousState;\r\n\r\n        this.dataIndex = index; // Holds the index the data point will retrieve data from\r\n        this.labelText = \"\";\r\n        this.baseColor = isState ? previousState.baseColor : \"#aa00ff\";\r\n        this.radius = origRadius;\r\n        this.shadowMargin = 7;\r\n        this.shadowMargin = isState ? previousState.shadowMargin : 7;\r\n        this.shadowPushBack = 1;\r\n        this.textPullForward = -5;\r\n\r\n        this.shadow = {};\r\n        this.shadow.geometry = new THREE.CircleGeometry(this.radius + this.shadowMargin, 32);\r\n        this.shadow.mesh = new THREE.Mesh(this.shadow.geometry);\r\n        this.shadow.mesh.material =\r\n            new THREE.MeshBasicMaterial({\r\n                color: \"#cccccc\"\r\n            });\r\n\r\n        this.object = {};\r\n        this.object.geometry = new THREE.CircleGeometry(this.radius, 32);\r\n        this.object.mesh = new THREE.Mesh(this.object.geometry);\r\n        this.object.mesh.material =\r\n            new THREE.MeshBasicMaterial({\r\n                color: this.baseColor\r\n            });\r\n\r\n        this.object.mesh.position.set(0, 0, 0);\r\n        this.shadow.mesh.position.set(0, 0, this.shadowPushBack);\r\n\r\n        this.position = this.object.mesh.position;\r\n        this.shadow.position = this.shadow.mesh.position;\r\n\r\n        this.object.scale = this.object.mesh.scale;\r\n        this.shadow.scale = this.shadow.mesh.scale;\r\n\r\n        this.withinCircle = function (x, y) {\r\n            let pos = this.object.mesh.position;\r\n            let distance = Math.sqrt((x - pos.x) * (x - pos.x) + (y - pos.y) * (y - pos.y));\r\n            let within = !(distance > this.radius);\r\n            if (within) {\r\n                //Add highlight border\r\n                //this.object.mesh.material.color.set(\"#000000\");\r\n            }else{\r\n                //Normal border\r\n                //this.object.mesh.material.color.set(this.baseColor.toString());\r\n            }\r\n            return within;\r\n        };\r\n\r\n        this.adjustScale = function (newRadius) {\r\n            this.radius = newRadius;\r\n            let newScale = this.radius / origRadius;\r\n            this.object.scale.set(newScale, newScale, newScale);\r\n            this.shadow.scale.set(newScale, newScale, newScale);\r\n        };\r\n\r\n        this.appendText = function (font, text, xpos, ypos) {\r\n            this.labelText = text;\r\n            var geometry = new THREE.TextGeometry(text, {\r\n                font: font,\r\n                size: 13,\r\n                height: 5,\r\n                curveSegments: 12,\r\n                bevelEnabled: false,\r\n                bevelThickness: 1,\r\n                bevelSize: 2,\r\n                bevelSegments: 5\r\n            });\r\n            let material = new THREE.MeshBasicMaterial({\r\n                color: 0x000000\r\n            });\r\n            this.textMesh = new THREE.Mesh(geometry, material);\r\n            this.moveText(xpos, ypos);\r\n            this.textMesh.rotation.set(0, 0, Math.PI);\r\n            this.changeTextSize(this.radius);\r\n        };\r\n\r\n        this.moveText = function (newX, newY) {\r\n            var box = new THREE.Box3().setFromObject(this.textMesh); // To center text horizontally\r\n            this.textMesh.position.set(newX + .5 * (box.max.x - box.min.x), newY, this.textPullForward);\r\n        }\r\n\r\n        this.moveIndexText = function (newX, newY) {\r\n            var box = new THREE.Box3().setFromObject(this.indexTextMesh); // To center text horizontally\r\n            this.indexTextMesh.position.set(newX + .5 * (box.max.x - box.min.x), newY, this.textPullForward);\r\n        }\r\n\r\n        this.setPosition = function (x, y, z) {\r\n            this.position.set(x, y, z);\r\n            this.shadow.position.set(x, y, this.shadowPushBack);\r\n        }\r\n\r\n        this.changeTextSize = function (newScale) {\r\n            let scale = newScale / origRadius;\r\n            this.textMesh.scale.set(scale, scale, scale + this.textPullForward);\r\n        }\r\n        this.changeIndexTextSize = function (newScale) {\r\n            let scale = newScale / origRadius;\r\n            this.indexTextMesh.scale.set(scale, scale, scale + this.textPullForward);\r\n        }\r\n\r\n        this.transformColor = function (colorObject) {\r\n            return tinycolor({\r\n                r: colorObject[0],\r\n                g: colorObject[1],\r\n                b: colorObject[2]\r\n            }).toHexString();\r\n        }\r\n\r\n        this.changeColor = function (colorObject) {\r\n            this.baseColor = this.transformColor(colorObject);\r\n            this.object.mesh.material.color.set(this.baseColor.toString());\r\n        };\r\n\r\n        this.lightenColor = function (percent) {\r\n            this.object.mesh.material.color.set(tinycolor(this.baseColor).lighten(percent).toString());\r\n        };\r\n\r\n        this.darkenColor = function (percent) {\r\n            this.object.mesh.material.color.set(tinycolor(this.baseColor).darken(percent).toString());\r\n        };\r\n\r\n        this.showIndex = function (font) {\r\n            var geometry = new THREE.TextGeometry(this.dataIndex.toString(), {\r\n                font: font,\r\n                size: 10,\r\n                height: 5,\r\n                curveSegments: 12,\r\n                bevelEnabled: false,\r\n                bevelThickness: 1,  \r\n                bevelSize: 2,\r\n                bevelSegments: 5\r\n            });\r\n            let material = new THREE.MeshBasicMaterial({\r\n                color: 0x808080\r\n            });\r\n            this.indexTextMesh = new THREE.Mesh(geometry, material);\r\n            this.moveIndexText(this.position.x, this.position.y + (3/4)*(this.radius));\r\n            this.indexTextMesh.rotation.set(0, 0, Math.PI);\r\n            this.changeIndexTextSize(this.radius);\r\n        };\r\n\r\n        if (isState) {\r\n            this.adjustScale(previousState.radius);\r\n            this.object.mesh.position.set(previousState.position.x, previousState.position.y, previousState.position.z);\r\n            this.shadow.mesh.position.set(previousState.shadow.position.x, previousState.shadow.position.y, previousState.shadow.position.z);\r\n        }\r\n\r\n        this.update = function () {\r\n\r\n        };\r\n    };\r\n}\r\n\r\nexport default DataPoint;","export default class ActionUtilities  {\r\n\r\n    sleep(ms) {\r\n        return new Promise(resolve => setTimeout(resolve, ms));\r\n      }\r\n\r\n      \r\n}","import * as THREE from 'three'\r\n\r\nclass ProgressBar {\r\n\r\n    constructor(scene, fontResource, yPos) {\r\n        const barLength = 500;\r\n        this.stepLength = 0;\r\n        this.yPos = yPos;\r\n\r\n        this.bar = {};\r\n        this.progress = {};\r\n        this.start = {};\r\n        this.stop = {};\r\n\r\n        this.bar.geometry = new THREE.BoxGeometry( barLength, 20, 1 );\r\n        this.bar.mesh = new THREE.Mesh(this.bar.geometry);\r\n        this.bar.mesh.material = new THREE.MeshBasicMaterial( {color: \"#afafaf\"} );\r\n\r\n        this.progressLength = 0;\r\n        this.progress.geometry = new THREE.BoxGeometry( this.progressLength, 20, 1 );\r\n        this.progress.mesh = new THREE.Mesh( this.progress.geometry);\r\n        this.progress.mesh.material = new THREE.MeshBasicMaterial( {color: \"#666666\"} );\r\n        this.bar.mesh.position.set(0, this.yPos, 0);\r\n        this.progress.mesh.position.set((barLength-this.progressLength)/2, this.yPos, 0);//TODO: Make height to bottom of screen + padding\r\n        scene.add(this.bar.mesh);\r\n        scene.add(this.progress.mesh);\r\n\r\n        this.updateProgress = function(step, timeInfo){\r\n            if (this.stepLength * step <= barLength){\r\n                this.progressLength = this.stepLength * step;\r\n                this.progress.mesh.geometry = new THREE.BoxGeometry( this.progressLength, 20, 1 );\r\n                this.progress.mesh.position.set((barLength-this.progressLength)/2, this.yPos, 0);//TODO: Make height to bottom of screen + padding\r\n                this.appendText(timeInfo)\r\n            }\r\n        }\r\n\r\n        this.appendText = function (text) {\r\n            if(this.textMesh != null){\r\n                scene.remove(this.textMesh)\r\n            }\r\n            var geometry = new THREE.TextGeometry(text, {\r\n                font: fontResource,\r\n                size: 10,\r\n                height: 5,\r\n                curveSegments: 12,\r\n                bevelEnabled: false,\r\n                bevelThickness: 1,\r\n                bevelSize: 2,\r\n                bevelSegments: 5\r\n            });\r\n            let material = new THREE.MeshBasicMaterial({ color: 0x000000 });\r\n            this.textMesh = new THREE.Mesh(geometry, material);\r\n            this.textMesh.position.set(250 - this.progressLength, this.yPos + 25, 0);\r\n            this.textMesh.rotation.set(0, 0, Math.PI);\r\n            scene.add(this.textMesh);\r\n        };\r\n\r\n        this.showTitle = function () {\r\n            var geometry = new THREE.TextGeometry(\"Progress Bar:\", {\r\n                font: fontResource,\r\n                size: 10,\r\n                height: 5,\r\n                curveSegments: 12,\r\n                bevelEnabled: false,\r\n                bevelThickness: 1,  \r\n                bevelSize: 2,\r\n                bevelSegments: 5\r\n            });\r\n            let material = new THREE.MeshBasicMaterial({ color: 0x000000 });\r\n            this.titleTextMesh = new THREE.Mesh(geometry, material);\r\n            this.titleTextMesh.position.set(350, this.yPos + 7, 0);\r\n            this.titleTextMesh.rotation.set(0, 0, Math.PI);\r\n            scene.add(this.titleTextMesh);\r\n        };\r\n\r\n        this.moveText = function(newX, newY){\r\n            var box = new THREE.Box3().setFromObject( this.textMesh );//To center text horizontally\r\n            this.textMesh.position.set(newX + .5*(box.max.x - box.min.x), newY, 0);\r\n        }\r\n\r\n        this.withinBar = function (x, y) {\r\n            var withinHeight = (y < this.yPos + 10) && (y > this.yPos - 10)\r\n            var withinWidth = (x < 250) && ( x > -250)\r\n            return withinHeight && withinWidth\r\n        };\r\n\r\n        this.getStep = function (x) {\r\n            var clickedPos = 250 - x;\r\n            var step = Math.round(clickedPos/this.stepLength);\r\n            return step;\r\n        };\r\n\r\n       this.setSteps = function (numOfSteps){\r\n            this.stepLength = barLength/numOfSteps;\r\n        }\r\n\r\n        this.getBar = function (){\r\n            return this.progress.mesh\r\n        }\r\n    };\r\n}\r\n\r\nexport default ProgressBar; ","import * as THREE from 'three'\r\n\r\nclass FluxArrow {\r\n    constructor(arrowInfo, legacySaveIndex) {\r\n        var tinycolor = require('tinycolor2');\r\n        this.arrowInfo = arrowInfo;\r\n        this.arrowInfo.dataIndex = (arrowInfo.dataIndex !== undefined) ? arrowInfo.dataIndex : legacySaveIndex; // Keep a defined value or fallback to legacy index\r\n        var arrowLength = 22 * (arrowInfo.dataPointRadius/40);\r\n        var arrowWidth = 15 * (arrowInfo.dataPointRadius/40); //Keep relative proportions liked with data points of radius 40 \r\n        this.textPullForward = -5;\r\n\r\n        this.calculateLength = function () {\r\n            //Length from center to center\r\n            let distance = Math.sqrt((this.arrowInfo.point2.x - this.arrowInfo.point1.x) * (this.arrowInfo.point2.x - this.arrowInfo.point1.x) +\r\n                (this.arrowInfo.point2.y - this.arrowInfo.point1.y) * (this.arrowInfo.point2.y - this.arrowInfo.point1.y));\r\n            //Moves each end to edge of circle plus 1/2 of radius more\r\n            distance = distance - 3 * (this.arrowInfo.dataPointRadius)\r\n            return distance;\r\n        };\r\n        this.calculateDir = function () {\r\n           return new THREE.Vector3(this.arrowInfo.point2.x - this.arrowInfo.point1.x, this.arrowInfo.point2.y - this.arrowInfo.point1.y, 0);\r\n        }\r\n        this.calculatePos = function () {\r\n            var adjust = new THREE.Vector3(1.5 * arrowInfo.dataPointRadius * this.dir.x, 1.5 * arrowInfo.dataPointRadius * this.dir.y, 0) //1.5 * 40 = To edge + 50% of circle radius\r\n            var shiftAmount = arrowInfo.dataPointRadius/3.5;\r\n            if (arrowInfo.shift){\r\n                var diff = (this.dir.x - this.dir.y)\r\n                if (diff >= 0){\r\n                    if (this.dir.y <= -.5) {\r\n                        adjust.x += shiftAmount;\r\n                    }else{\r\n                        adjust.y += shiftAmount;\r\n                    }\r\n                } else {\r\n                    if (this.dir.y >= .5) {\r\n                        adjust.x += shiftAmount;\r\n                    }else{\r\n                        adjust.y += shiftAmount;\r\n                    }\r\n                }\r\n            }\r\n            return new THREE.Vector3(this.arrowInfo.point1.x + adjust.x, this.arrowInfo.point1.y + adjust.y, 0)\r\n        }\r\n\r\n\r\n        this.baseColor = \"#222222\"\r\n        this.object = {};\r\n        this.dir = this.calculateDir();\r\n        this.dir.normalize();\r\n        this.length = this.calculateLength();\r\n        this.position = this.calculatePos();\r\n\r\n        this.object = new THREE.ArrowHelper(this.dir, this.position, this.length, this.baseColor, arrowLength, arrowWidth);\r\n\r\n        this.lightenColor = function (percent) {\r\n            var newColor = tinycolor(this.baseColor).lighten(percent).toString();\r\n            this.object = new THREE.ArrowHelper(this.dir, this.position, this.length, newColor, arrowLength, arrowWidth);\r\n        };\r\n\r\n        this.darkenColor = function (percent) {\r\n            var newColor = tinycolor(this.baseColor).darken(percent).toString();\r\n            this.object = new THREE.ArrowHelper(this.dir, this.position, this.length, newColor, arrowLength, arrowWidth);\r\n        };\r\n\r\n        this.updatePos = function (to, from) {\r\n            this.arrowInfo.point1 = to;\r\n            this.arrowInfo.point2 = from;\r\n\r\n            this.dir = this.calculateDir();\r\n            this.dir.normalize();\r\n            this.length = this.calculateLength();\r\n            this.position = this.calculatePos();\r\n\r\n            this.object.setLength(this.length, arrowLength, arrowWidth);\r\n            this.object.setDirection(this.dir);\r\n            this.object.position.set(this.position.x, this.position.y, 0);\r\n        };\r\n\r\n        this.setLength = function (len) {\r\n            this.object.setLength(len);\r\n        };\r\n\r\n        this.delete = function () {\r\n            this.scene.remove(this.object);\r\n        };\r\n\r\n        this.adjustScale = function (newRadius) {\r\n            arrowInfo.dataPointRadius = newRadius\r\n            arrowLength = 22 * (arrowInfo.dataPointRadius/40);\r\n            arrowWidth = 15 * (arrowInfo.dataPointRadius/40);\r\n            this.updatePos(this.arrowInfo.point1, this.arrowInfo.point2);\r\n        };\r\n\r\n        this.showIndex = function (font) {\r\n            var geometry = new THREE.TextGeometry(this.arrowInfo.dataIndex.toString(), {\r\n                font: font,\r\n                size: 10,\r\n                height: 5,\r\n                curveSegments: 12,\r\n                bevelEnabled: false,\r\n                bevelThickness: 1,  \r\n                bevelSize: 2,\r\n                bevelSegments: 5\r\n            });\r\n            let material = new THREE.MeshBasicMaterial({\r\n                color: 0x808080\r\n            });\r\n            this.indexTextMesh = new THREE.Mesh(geometry, material);\r\n            this.moveIndexText(this.position.x, this.position.y);\r\n            this.indexTextMesh.rotation.set(0, 0, Math.PI);\r\n           // this.changeIndexTextSize(this.length);\r\n        };\r\n\r\n        this.changeIndexTextSize = function (newScale) {\r\n            let scale = newScale / this.origLength;\r\n            scale = scale === 0 ? (scale = 0.00010) : scale; \r\n            this.indexTextMesh.scale.set(scale, scale, scale + this.textPullForward);\r\n        };\r\n\r\n        this.moveIndexText = function (newX, newY) {\r\n            var box = new THREE.Box3().setFromObject(this.indexTextMesh); // To center text horizontally\r\n            this.indexTextMesh.position.set(newX + .5 * (box.max.x - box.min.x), newY, this.textPullForward);\r\n        };\r\n    };\r\n}\r\n\r\nexport default FluxArrow","/* Imported From: https://itnext.io/how-to-use-plain-three-js-in-your-react-apps-417a79d926e0 */\r\nimport * as THREE from 'three';\r\nimport DataPoint from './DataPoint';\r\nimport * as dat from 'dat.gui';\r\nimport ActionUtilities from '../ActionUtilities';\r\nimport ProgressBar from './ProgressBar';\r\nimport FluxArrow from './FluxArrow';\r\n\r\nexport default (canvas, data) => {\r\n\r\n    const actionUtil = new ActionUtilities();\r\n\r\n    const origin = new THREE.Vector3(0, 0, 0);\r\n    const screenDimensions = {\r\n        width: canvas.width,\r\n        height: canvas.height\r\n    }\r\n    const origRadius = 40;\r\n\r\n    var paused = true;\r\n    var stepInc = 1;\r\n    data.color = data.color || [70, 156, 150, 1];\r\n    data.stepDelay = data.stepDelay || 300;\r\n    data.valueMax = data.valueMax || 1;\r\n    data.fluxMax = data.fluxMax || 1;\r\n    data.skipSteps = data.skipSteps || 1;\r\n    data.radius = data.radius || origRadius;\r\n    var halfQuantity = data.valueMax / 2.0;\r\n    var halfFlux = data.fluxMax / 2.0;\r\n    var baseColor = [170, 0, 255, 1];\r\n    var radius = data.radius || origRadius;\r\n\r\n    var mouseDown = false;\r\n    var dataPointToMove = -1;\r\n    var userSelectedDataPoint = -1;\r\n\r\n    var progressBar;\r\n    var editMode;\r\n    var arrowMode = 0; //0 = Off, 1 = Waiting for 1st point, 2 = Waiting for 2nd point\r\n    var arrowPoints = [] //After `Add Arrow`, [0] holds FROM data point's index, [1] holds TO data point's index\r\n\r\n    var fontResource;\r\n\r\n    const controls = {\r\n        size: radius,\r\n        valueMax: data.valueMax,\r\n        fluxMax: data.fluxMax,\r\n        stepDelay: data.stepDelay,\r\n        color: data.color,\r\n        skipSteps: data.skipSteps,\r\n        generateCompartments: function () {\r\n            generateCompartments();\r\n        },\r\n        generateFluxArrows: function () {\r\n            generateFluxArrows();\r\n        },\r\n        seekHelp: function () {\r\n            window.open(window.location.href + 'help.html', '_blank');\r\n        },\r\n        changeStep: function () {\r\n            startStepping(true);\r\n        },\r\n        startAnimation: function () {\r\n            startStepping();\r\n        },\r\n        pauseAnimation: function () {\r\n            paused = true;\r\n        },\r\n        resetAnimation: reset,\r\n        addPoint: function () {\r\n            if (editMode) {\r\n                addPoint();\r\n            }\r\n        },\r\n        addArrow: function () {\r\n            if (editMode) {\r\n                arrowMode = 1;\r\n            }\r\n        },\r\n        deletePoint: function () {\r\n            if (editMode) {\r\n                deleteDataPoint();\r\n            }\r\n        },\r\n        showIndices: false,\r\n        compIndex: \"\",\r\n        label: \"\",\r\n        editMode: false,\r\n        labelMode: false\r\n    }\r\n\r\n    loadFont();\r\n    const scene = buildScene();\r\n    const renderer = buildRender(screenDimensions);\r\n    const camera = buildCamera(screenDimensions);\r\n    var datGui = buildGUI();\r\n\r\n    function reset() {\r\n        if (data.animationData) {\r\n            data.step = 0;\r\n            paused = true;\r\n            progressBar.updateProgress(0, data.animationData[0][0]);\r\n            applyStep();\r\n        }\r\n    }\r\n\r\n    data.onFluxLoad = () => {}\r\n    data.onLoad = () => {\r\n        if (data.animationData != null) {\r\n            progressBar.appendText(data.animationData[0][0]);\r\n            progressBar.setSteps(data.animationData.length);\r\n        }\r\n    }\r\n    data.registerCallback(reloadScene);\r\n\r\n    function loadFont() {\r\n        var loader = new THREE.FontLoader();\r\n        loader.load(\r\n            'https://threejs.org//examples/fonts/helvetiker_regular.typeface.json',\r\n            fontLoadingComplete\r\n        );\r\n    }\r\n\r\n    function fontLoadingComplete(font) {\r\n        fontResource = font;\r\n        reloadScene();\r\n    }\r\n\r\n    function reloadScene() {\r\n        clearScene();\r\n        reloadDataPoints();\r\n        reloadArrows();\r\n        buildProgressBar();\r\n        updatePanel();\r\n    }\r\n\r\n    function updatePanel() {\r\n        data.skipSteps = data.skipSteps || 1;\r\n        data.stepDelay = data.stepDelay || 300;\r\n        data.valueMax = data.valueMax || 1;\r\n        data.fluxMax = data.fluxMax || 1;\r\n        data.color = data.color || [70, 156, 150, 1];\r\n        data.radius = data.radius || origRadius;\r\n        radius = data.radius;\r\n        halfQuantity = data.valueMax / 2.0;\r\n        halfFlux = data.fluxMax / 2.0;\r\n        controls.size = data.radius;\r\n        controls.skipSteps = data.skipSteps;\r\n        controls.valueMax = data.valueMax;\r\n        controls.fluxMax = data.fluxMax;\r\n        controls.stepDelay = data.stepDelay;\r\n        controls.color = data.color;\r\n        datGui.updateDisplay();\r\n    }\r\n\r\n    function clearScene() {\r\n        let remove = [];\r\n        scene.traverse((child) => {\r\n            if (child instanceof THREE.Mesh || child instanceof THREE.ArrowHelper) {\r\n                remove.push(child);\r\n            }\r\n        });\r\n        for (let i = 0; i < remove.length; i++) {\r\n            scene.remove(remove[i]);\r\n        }\r\n    }\r\n\r\n    function reloadArrows() {\r\n        let hydratedArrows = [];\r\n        let legacyArrowIndex = 0;\r\n        data.arrows.forEach(oldArrow => {\r\n            hydratedArrows.push(restoreArrow(oldArrow, legacyArrowIndex++));\r\n        });\r\n        data.arrows = hydratedArrows;\r\n    }\r\n\r\n    function reloadDataPoints() {\r\n        let hydratedPoints = [];\r\n        let c = 0;\r\n        data.dataPoints.forEach(oldPoint => {\r\n            if (!oldPoint.dataIndex) { // For converting legacy saves on the fly\r\n                oldPoint.dataIndex = c++;\r\n            }\r\n            let point = restoreDataPoint(oldPoint);\r\n            hydratedPoints.push(point);\r\n            point.moveText(point.object.mesh.position.x, point.object.mesh.position.y);\r\n        });\r\n        data.dataPoints = hydratedPoints;\r\n    }\r\n\r\n    function buildGUI() {\r\n        var gui = new dat.GUI({\r\n            autoPlace: false\r\n        });\r\n        var customContainer = document.getElementById('datGuiAnchor');\r\n        customContainer.appendChild(gui.domElement);\r\n        gui.domElement.id = 'datGuiAnchor';\r\n        gui.add(controls, 'seekHelp').name(\"Help\");\r\n        var animation = gui.addFolder(\"Animation\");\r\n        buildAnimationFolder(animation);\r\n        var editing = gui.addFolder(\"Model Editing\");\r\n        buildEditingFolder(editing);\r\n        var interpretation = gui.addFolder(\"Interpretation\");\r\n        buildInterpretationFolder(interpretation);\r\n        return gui;\r\n    }\r\n\r\n    function buildAnimationFolder(folder) {\r\n        folder.add(controls, 'changeStep').name(\"Step - -- -- -| \\u21E5\");\r\n        folder.add(controls, 'startAnimation').name(\"Start - -- -- -| \\u25B6\");\r\n        folder.add(controls, 'pauseAnimation').name(\"Pause - -- -| \\u23F8\");\r\n        folder.add(controls, 'resetAnimation').name(\"Reset - --- -| \\u21BB\");\r\n        var timeController = folder.add(controls, 'stepDelay').name(\"Delay (in ms)\").min(0).max(500).step(10)\r\n        timeController.onChange(function (newValue) {\r\n            data.stepDelay = newValue;\r\n        });\r\n        folder.add(controls, 'skipSteps').name(\"Step Size\").onChange(function (newValue) {\r\n            data.skipSteps = newValue;\r\n        });\r\n        return folder;\r\n    }\r\n\r\n    function buildEditingFolder(editFolder) {\r\n        editFolder.add(controls, 'generateCompartments').name(\"Generate Comps.\");\r\n        editFolder.add(controls, 'generateFluxArrows').name(\"Generate Flux.\");\r\n        editFolder.add(controls, 'editMode').name(\"Edit Mode\").onChange(function (newValue) {\r\n            editMode = newValue;\r\n        });\r\n        editFolder.add(controls, 'labelMode').name(\"Import Labels\").onChange(function (newValue) {\r\n            data.labelMode = newValue;\r\n        });\r\n        editFolder.add(controls, 'showIndices').name(\"Show Indices\").onChange(function (show) {\r\n            revealIndices(show);\r\n        });\r\n        editFolder.add(controls, 'compIndex').name(\"Data Index\").listen().onFinishChange(function (newValue) {\r\n            if (userSelectedDataPoint !== -1) {\r\n                if ((newValue > data.dataPoints.length) || (newValue < 1)) {\r\n                    alert(\"Invalid Index\");\r\n                } else {\r\n                    data.dataPoints[userSelectedDataPoint].dataIndex = newValue;\r\n                    scene.remove(data.dataPoints[userSelectedDataPoint].indexTextMesh);\r\n                    if (controls.showIndices) {\r\n                        data.dataPoints[userSelectedDataPoint].showIndex(fontResource);\r\n                        scene.add(data.dataPoints[userSelectedDataPoint].indexTextMesh);\r\n                    }\r\n                }\r\n            }\r\n        });\r\n        editFolder.add(controls, 'label').name(\"Comp. Label\").listen().onFinishChange(function (newValue) {\r\n            scene.remove(data.dataPoints[userSelectedDataPoint].textMesh);\r\n            data.dataPoints[userSelectedDataPoint].appendText(fontResource, newValue, data.dataPoints[userSelectedDataPoint].position.x, data.dataPoints[userSelectedDataPoint].position.y);\r\n            scene.add(data.dataPoints[userSelectedDataPoint].textMesh);\r\n        });\r\n        editFolder.add(controls, 'addPoint').name(\"Add Compartment\");\r\n        editFolder.add(controls, 'addArrow').name(\"Add Arrow\");\r\n        editFolder.add(controls, 'deletePoint').name(\"Delete Compartment\");\r\n        var sizeController = editFolder.add(controls, 'size').name(\"Size\").min(10).max(100).step(1);\r\n        sizeController.onChange(function (newValue) {\r\n            radius = newValue; //Ratio of original size\r\n            data.radius = radius;\r\n            changeAllRadius();\r\n        });\r\n        return editFolder;\r\n    }\r\n\r\n    function buildInterpretationFolder(folder) {\r\n        var maxController = folder.add(controls, 'valueMax').name(\"Comp. Maximum\");\r\n        maxController.onChange(function (newValue) {\r\n            data.valueMax = newValue;\r\n            halfQuantity = data.valueMax / 2.0;\r\n        });\r\n        var maxFluxController = folder.add(controls, 'fluxMax').name(\"Flux Maximum\");\r\n        maxFluxController.onChange(function (newValue) {\r\n            data.fluxMax = newValue;\r\n            halfFlux = data.fluxMax / 2.0;\r\n        });\r\n        var colorController = folder.addColor(controls, 'color').name(\"50% Max Color\");\r\n        colorController.onChange(function (newValue) {\r\n            baseColor = newValue;\r\n            changeColor(baseColor);\r\n        });\r\n        return folder;\r\n    }\r\n\r\n    function buildProgressBar() {\r\n        let rect = canvas.getBoundingClientRect();\r\n        progressBar = new ProgressBar(scene, fontResource, (-rect.height / 2.0) + 25);\r\n        progressBar.appendText(\"0\");\r\n        progressBar.showTitle();\r\n    }\r\n\r\n    function setupEventListeners() {\r\n        canvas.addEventListener(\"mousedown\", function (evt) {\r\n            mouseDown = true;\r\n            checkWithinRange(canvas, evt);\r\n        });\r\n        canvas.addEventListener(\"mouseup\", function (evt) {\r\n            if (editMode) {\r\n                if (arrowMode === 1) {\r\n                    arrowMode = 2;\r\n                    checkWithinRange(canvas, evt);\r\n                    if ((arrowPoints[0] != null) && (arrowPoints[1] != null)) {\r\n                        addArrow();\r\n                    } else {\r\n                        alert(\"Dragged line was not between two data points\");\r\n                    }\r\n                    //Reset arrow points\r\n                    arrowPoints[0] = null;\r\n                    arrowPoints[1] = null;\r\n                }\r\n                mouseDown = false;\r\n                dataPointToMove = -1; //No current selected dataPoint\r\n            }\r\n            if (data.arrows.length > 0) {\r\n                updateArrows(-1);\r\n            }\r\n        });\r\n        canvas.addEventListener(\"mousemove\", function (evt) {\r\n            if (editMode) {\r\n                if (mouseDown) {\r\n                    var mousePos = getMousePos(canvas, evt);\r\n                    var newMousePos = canvasToThreePos(mousePos);\r\n                    if (dataPointToMove > -1) {\r\n                        data.dataPoints[dataPointToMove].setPosition(newMousePos.x, newMousePos.y, 0);\r\n                        data.dataPoints[dataPointToMove].moveText(newMousePos.x, newMousePos.y);\r\n                        if (controls.showIndices) {\r\n                            data.dataPoints[dataPointToMove].moveIndexText(newMousePos.x, newMousePos.y + (3 / 4) * (data.dataPoints[dataPointToMove].radius));\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    function checkWithinRange(canvas, evt) {\r\n        var mousePos = canvasToThreePos(getMousePos(canvas, evt));\r\n        //Check if click was on data point\r\n        controls.compIndex = \"\"; //Clear\r\n        controls.label = \"\"; //Clear\r\n        if (editMode) {\r\n            for (var i = 0; i < data.dataPoints.length; i++) {\r\n                var selected = data.dataPoints[i].withinCircle(mousePos.x, mousePos.y);\r\n                if (selected && arrowMode === 1) {\r\n                    data.dataPoints[i].shadow.mesh.material.color.set(\"#ffff00\");\r\n                    arrowPoints[0] = i\r\n                } else if (selected && arrowMode === 2) {\r\n                    data.dataPoints[i].shadow.mesh.material.color.set(\"#ffff00\");\r\n                    arrowPoints[1] = i\r\n                } else if (selected) {\r\n                    if (userSelectedDataPoint !== -1) {\r\n                        data.dataPoints[userSelectedDataPoint].shadow.mesh.material.color.set(\"#cccccc\");\r\n                    }\r\n                    data.dataPoints[i].shadow.mesh.material.color.set(\"#ffff00\");\r\n                    dataPointToMove = i;\r\n                    controls.compIndex = data.dataPoints[i].dataIndex;\r\n                    controls.label = data.dataPoints[i].labelText;\r\n                    userSelectedDataPoint = i;\r\n                    break;\r\n                } else {\r\n                    data.dataPoints[i].shadow.mesh.material.color.set(\"#cccccc\");\r\n                }\r\n            }\r\n        }\r\n        if (dataPointToMove === -1 && progressBar) { //Click was not on a datapoint\r\n            userSelectedDataPoint = -1; //Deselect previous selection\r\n            if (data.animationData && !isDataLoaded()) {\r\n                alert(\"Please import data first\");\r\n                return;\r\n            }\r\n\r\n            //Check if click was on progress bar\r\n            if (progressBar.withinBar(mousePos.x, mousePos.y) && data.animationData) {\r\n                var clickedStep = progressBar.getStep(mousePos.x);\r\n                let text = data.animationData[clickedStep - 1];\r\n                progressBar.updateProgress(clickedStep, text ? text[0] : \"0\")\r\n                data.step = clickedStep - 1;\r\n                applyStep();\r\n            }\r\n        }\r\n    }\r\n\r\n    function getMousePos(canvas, evt) {\r\n        var rect = canvas.getBoundingClientRect();\r\n        return {\r\n            x: evt.clientX - rect.left,\r\n            y: evt.clientY - rect.top\r\n        };\r\n    }\r\n\r\n    function canvasToThreePos(mousePos) {\r\n        var rect = canvas.getBoundingClientRect();\r\n        var newX, newY;\r\n        newX = (rect.width / 2) - mousePos.x;\r\n        newY = mousePos.y - (rect.height / 2);\r\n        return {\r\n            x: newX,\r\n            y: newY\r\n        };\r\n    }\r\n\r\n    function buildScene() {\r\n        setupEventListeners();\r\n        const scene = new THREE.Scene();\r\n        scene.background = new THREE.Color(\"#FFF\");\r\n        return scene;\r\n    }\r\n\r\n    function buildRender({\r\n        width,\r\n        height\r\n    }) {\r\n        const renderer = new THREE.WebGLRenderer({\r\n            canvas: canvas,\r\n            antialias: true,\r\n            alpha: true\r\n        });\r\n        const DPR = window.devicePixelRatio ? window.devicePixelRatio : 1;\r\n        renderer.setPixelRatio(DPR);\r\n        renderer.setSize(width, height);\r\n\r\n        renderer.gammaInput = true;\r\n        renderer.gammaOutput = true;\r\n\r\n        return renderer;\r\n    }\r\n\r\n    function buildCamera({\r\n        width,\r\n        height\r\n    }) {\r\n        var camera = new THREE.OrthographicCamera(width / -2, width / 2, height / -2, height / 2, 1, 1000);\r\n        camera.position.set(0, 0, -10);\r\n        camera.lookAt(origin)\r\n        return (camera);\r\n    }\r\n\r\n    function isDataLoaded() {\r\n        if (data && !data.dataLoaded()) {\r\n            alert(\"Please import data first\");\r\n        }\r\n        return data.dataLoaded();\r\n    }\r\n\r\n    async function startStepping(singleStep = false) {\r\n        if (isDataLoaded()) {\r\n            paused = false;\r\n            stepForward(singleStep);\r\n        }\r\n    }\r\n\r\n    async function stepForward(singleStep = false) {\r\n        if (data.hasNextStep()) {\r\n            if (!paused) {\r\n                applyStep();\r\n                data.step += stepInc;\r\n                await actionUtil.sleep(data.stepDelay);\r\n                if (!singleStep)\r\n                    stepForward();\r\n            }\r\n        }\r\n    }\r\n\r\n    function applyStep() {\r\n        let text = data.step < 0 ? '0' : data.animationData[data.step][0];\r\n        if (data.step >= 0) {\r\n            colorPoints();\r\n        }\r\n        progressBar.updateProgress(data.step + 1, text);\r\n    }\r\n\r\n    function colorPoints() {\r\n        let changePercent, diff;\r\n\r\n        for (let i = 0; i < data.dataPoints.length; i++) {\r\n            if (data.animationData[data.step][data.dataPoints[i].dataIndex] > halfQuantity) { //i+1 because column 0 holds time info\r\n                //Darken\r\n                diff = data.animationData[data.step][data.dataPoints[i].dataIndex] - halfQuantity;\r\n                changePercent = diff / halfQuantity;\r\n                data.dataPoints[i].darkenColor(changePercent * 50); //Multiply by 50 - percent available to darken by\r\n            } else {\r\n                //Lighten\r\n                diff = halfQuantity - data.animationData[data.step][data.dataPoints[i].dataIndex];\r\n                changePercent = diff / halfQuantity;\r\n                data.dataPoints[i].lightenColor(changePercent * 50); //Multiply by 50 - percent available to lighten by\r\n            }\r\n        }\r\n        if (data.fluxData != null) {\r\n            for (let i = 0; i < data.arrows.length - 1; i++) {\r\n                if (data.fluxData[data.step][data.arrows[i].arrowInfo.dataIndex] > halfFlux) { //i+1 because column 0 holds time info\r\n                    //Darken\r\n                    diff = data.fluxData[data.step][data.arrows[i].arrowInfo.dataIndex] - halfFlux;\r\n                    changePercent = diff / halfFlux;\r\n                    scene.remove(data.arrows[i].object);\r\n                    data.arrows[i].darkenColor(changePercent * 50); //Multiply by 50 - percent available to darken by\r\n                    scene.add(data.arrows[i].object) //Add newly colored arrow\r\n                } else {\r\n                    //Lighten\r\n                    diff = halfFlux - data.fluxData[data.step][data.arrows[i].arrowInfo.dataIndex];\r\n                    changePercent = diff / halfFlux;\r\n                    scene.remove(data.arrows[i].object);\r\n                    data.arrows[i].lightenColor(changePercent * 50); //Multiply by 50 - percent available to lighten by\r\n                    scene.add(data.arrows[i].object) //Add newly colored arrow\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function restoreArrow(savedData, legacyIndex) {\r\n        let arrow = new FluxArrow(savedData.arrowInfo, legacyIndex);\r\n        scene.add(arrow.object);\r\n        return arrow;\r\n    }\r\n\r\n    function restoreDataPoint(savedData) {\r\n        // let labels = data.labels;\r\n        let dataPoint = new DataPoint(savedData.dataIndex, savedData); //TODO index\r\n        scene.add(dataPoint.object.mesh);\r\n        scene.add(dataPoint.shadow.mesh);\r\n        let labelText = savedData.textMesh ? savedData.textMesh.geometries[0].text : \" \";\r\n        if (!labelText)\r\n            labelText = \" \";\r\n        dataPoint.appendText(fontResource, labelText, dataPoint.position.x, dataPoint.position.y);\r\n        scene.add(dataPoint.textMesh);\r\n        // labels.push(labelText);\r\n        return dataPoint;\r\n    }\r\n\r\n    function addPoint() {\r\n        let labels = data.labels;\r\n        let labelMode = data.labelMode;\r\n        let dataPoints = data.dataPoints;\r\n        var labelText;\r\n        if (labelMode && labels.length > dataPoints.length + 1) {\r\n            labelText = labels[dataPoints.length + 1]\r\n        } else {\r\n            if (labelMode && labels.length <= dataPoints.length) {\r\n                labelText = window.prompt(\"Imported data does not contain a column #\" + dataPoints.length + \".\\nPlease label your data point: \");\r\n\r\n            } else {\r\n                labelText = window.prompt(\"Label your data point: \");\r\n            }\r\n        }\r\n        if ((!labelText) || (labelText === \"\")) {\r\n            alert(\"No label entered\");\r\n            return;\r\n        }\r\n        addDataPoint(labelText);\r\n    }\r\n\r\n    function addDataPoint(labelText) {\r\n        let dataPoints = data.dataPoints;\r\n        let dataPoint = new DataPoint(dataPoints.length + 1);\r\n        scene.add(dataPoint.object.mesh);\r\n        scene.add(dataPoint.shadow.mesh);\r\n        if (controls.showIndices) {\r\n            dataPoint.showIndex(fontResource);\r\n            scene.add(dataPoint.indexTextMesh);\r\n        }\r\n\r\n        dataPoint.changeColor(baseColor);\r\n        dataPoint.adjustScale(radius);\r\n        dataPoint.appendText(fontResource, labelText, dataPoint.position.x, dataPoint.position.y);\r\n        scene.add(dataPoint.textMesh);\r\n        dataPoints.push(dataPoint);\r\n        dataPoint.setPosition(0, 0, 0);\r\n        dataPoint.moveText(0, 0);\r\n    }\r\n\r\n    function removeFromScene(dataPoint) {\r\n        scene.remove(dataPoint.object.mesh);\r\n        scene.remove(dataPoint.shadow.mesh);\r\n        scene.remove(dataPoint.textMesh);\r\n    }\r\n\r\n    function addArrow() {\r\n        let arrows = data.arrows;\r\n        var shift = false;\r\n        //Check if new arrow is between an already arrowed combination\r\n        for (var i = 0; i < arrows.length; i++) {\r\n            if (arrows[i].arrowInfo.pointIndex1 === arrowPoints[0] && arrows[i].arrowInfo.pointIndex2 === arrowPoints[1]) {\r\n                //Arrow already exists in that direction-- do nothing\r\n                return\r\n            }\r\n            if (arrows[i].arrowInfo.pointIndex1 === arrowPoints[1] && arrows[i].arrowInfo.pointIndex2 === arrowPoints[0]) {\r\n                //Arrow exists in opposite direction-- shift new arrow\r\n                shift = true;\r\n            }\r\n        }\r\n        var arrowInfo = {\r\n            shift: shift,\r\n            len: 200,\r\n            pointIndex1: arrowPoints[0],\r\n            pointIndex2: arrowPoints[1],\r\n            point1: data.dataPoints[arrowPoints[0]].position,\r\n            point2: data.dataPoints[arrowPoints[1]].position,\r\n            dataPointRadius: radius,\r\n            dataIndex: data.arrows.length + 1,\r\n        }\r\n        let arrow = new FluxArrow(arrowInfo);\r\n        scene.add(arrow.object);\r\n        arrowMode = 0;\r\n        arrows.push(arrow);\r\n    }\r\n\r\n    function updateArrows(deletedDataPoint) {\r\n        let arrows = data.arrows;\r\n        for (var i = 0; i < arrows.length; i++) {\r\n            var index1 = arrows[i].arrowInfo.pointIndex1;\r\n            var index2 = arrows[i].arrowInfo.pointIndex2;\r\n            if ((index1 === deletedDataPoint) || (index2 === deletedDataPoint)) {\r\n                scene.remove(arrows[i].object)\r\n                arrows.splice(i, 1);\r\n                i--; //To go back and check arrow that just moved into i'th position\r\n            } else {\r\n                if ((index1 > deletedDataPoint) && (deletedDataPoint !== -1)) {\r\n                    index1--;\r\n                    arrows[i].arrowInfo.pointIndex1--;\r\n                }\r\n                if ((index2 > deletedDataPoint) && (deletedDataPoint !== -1)) {\r\n                    index2--;\r\n                    arrows[i].arrowInfo.pointIndex2--;\r\n                }\r\n                arrows[i].updatePos(data.dataPoints[index1].position, data.dataPoints[index2].position);\r\n                if (controls.showIndices) {\r\n                    arrows[i].moveIndexText(arrows[i].position.x, arrows[i].position.y);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function deleteDataPoint() {\r\n        if (userSelectedDataPoint > -1) {\r\n            removeFromScene(data.dataPoints[userSelectedDataPoint]);\r\n            data.dataPoints.splice(userSelectedDataPoint, 1);\r\n            // data.labels.splice(userSelectedDataPoint, 1);\r\n            userSelectedDataPoint = -1;\r\n        }\r\n        updateArrows(userSelectedDataPoint);\r\n    }\r\n\r\n    function changeColor(newColor) {\r\n        data.color = newColor;\r\n        for (var i = 0; i < data.dataPoints.length; i++) {\r\n            data.dataPoints[i].changeColor(newColor);\r\n        }\r\n    }\r\n\r\n    function changeAllRadius() {\r\n        let point;\r\n        for (let i = 0; i < data.dataPoints.length; i++) {\r\n            point = data.dataPoints[i];\r\n            point.adjustScale(radius);\r\n            point.changeTextSize(radius)\r\n            point.moveText(point.object.mesh.position.x, point.object.mesh.position.y);\r\n        }\r\n        for (let i = 0; i < data.arrows.length; i++) {\r\n            data.arrows[i].adjustScale(radius);\r\n        }\r\n    }\r\n\r\n    function revealIndices(show) {\r\n        if (show) {\r\n            for (let i = 0; i < data.dataPoints.length; i++) {\r\n                data.dataPoints[i].showIndex(fontResource);\r\n                scene.add(data.dataPoints[i].indexTextMesh);\r\n            }\r\n            for (let i = 0; i < data.arrows.length; i++) {\r\n                data.arrows[i].showIndex(fontResource);\r\n                scene.add(data.arrows[i].indexTextMesh);\r\n            }\r\n            return;\r\n        }\r\n\r\n        for (let i = 0; i < data.dataPoints.length; i++) {\r\n            scene.remove(data.dataPoints[i].indexTextMesh);\r\n        }\r\n        for (let i = 0; i < data.arrows.length; i++) {\r\n            scene.remove(data.arrows[i].indexTextMesh);\r\n        }\r\n\r\n    }\r\n\r\n    function generateCompartments() {\r\n        if (data.animationData == null) {\r\n            alert(\"Compartment data must be uploaded first\");\r\n            return;\r\n        } else if (data.dataPoints.length > 0) {\r\n            alert(\"Compartments already exist\");\r\n            return;\r\n        }\r\n        var rect = canvas.getBoundingClientRect();\r\n        var freeSpace = rect.width - (data.animationData[0].length * (radius * 2)) - 2 * radius; // - 2*radius allocates for a radius buffer space on each end\r\n        var spaceBetween = freeSpace / (data.animationData[0].length - 1);\r\n        for (var i = 0; i < data.animationData[0].length; i++) {\r\n            let xPos = -((rect.width / 2) - radius) + (i * radius * 2) + (i * spaceBetween) + radius; // + radius gives a radius buffer space on each end\r\n            let label = !!data.labels[i + 1] ? data.labels[i + 1] : (i + 1).toString();\r\n            addDataPoint(label);\r\n            //Move to appropriate location\r\n            data.dataPoints[i].setPosition(-xPos, -1, 0);\r\n            data.dataPoints[i].moveText(-xPos, 0);\r\n            if (controls.showIndices) {\r\n                data.dataPoints[i].moveIndexText(-xPos, (3 / 4) * (data.dataPoints[dataPointToMove].radius));\r\n            }\r\n        }\r\n    }\r\n\r\n    function generateFluxArrows() {\r\n        if (data.arrows.length > 0) {\r\n            alert(\"Flux Arrows already exist\");\r\n            return;\r\n        } else if (!data.fluxData) {\r\n            alert(\"Flux data must be uploaded first before automatic generation can take place.\");\r\n            return;\r\n        } else if (!data.fluxOriginLabels && !data.fluxDestinationLabels) {\r\n            alert(\"File Format does not support flux arrows. The first row must be the origin compartment and \" +\r\n                \"the second row must be the destination compartment.\");\r\n            return;\r\n        } else if (data.dataPoints.length <= 0) {\r\n            alert(\"Compartments must be created first for this operation to succeed.\");\r\n            return;\r\n        }\r\n        for (let i = 0; i < data.fluxData[0].length; i++) {\r\n            if (data.fluxDestinationLabels.length - 1 < i || data.fluxOriginLabels.length - 1 < i)\r\n                break;\r\n            if (!data.fluxDestinationLabels[i] || !data.fluxOriginLabels[i])\r\n                continue;\r\n            arrowPoints[0] = null;\r\n            arrowPoints[1] = null;\r\n            for (let j = 0; j < data.dataPoints.length; j++) {\r\n                const element = data.dataPoints[j].labelText.toLowerCase().trim();\r\n                if (element === data.fluxOriginLabels[i].toLowerCase().trim()) {\r\n                    arrowPoints[0] = j;\r\n                    if (arrowPoints[1] !== null) {\r\n                        addArrow();\r\n                        break;\r\n                    }\r\n                    continue;\r\n                }\r\n                if (element === data.fluxDestinationLabels[i].toLowerCase().trim()) {\r\n                    arrowPoints[1] = j;\r\n                    if (arrowPoints[0] !== null) {\r\n                        addArrow();\r\n                        break;\r\n                    }\r\n                    continue;\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function update() {\r\n        renderer.render(scene, camera);\r\n    }\r\n\r\n    return {\r\n        update\r\n    }\r\n}","import React, {\r\n  Component\r\n} from 'react';\r\nimport threeEntryPoint from '../lib/threejs/threeEntryPoint';\r\n\r\n/* Imported From: https://itnext.io/how-to-use-plain-three-js-in-your-react-apps-417a79d926e0 */\r\nexport default class ThreeContainer extends Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.dataContext = this.props.dataContext;\r\n  }\r\n\r\n  componentDidMount() {\r\n    threeEntryPoint(this.threeRootElement, this.dataContext);\r\n  }\r\n\r\n  render() {\r\n    return ( <div  className='canvas' ref={element => this.threeRootElement = element} > </div>);\r\n  }\r\n}","/** Imported From:  https://github.com/PierfrancescoSoffritti/pierfrancescosoffritti.com/blob/master/src/components/home/header/threejs/threeEntryPoint.js*/\r\nimport SceneManager from './SceneManager';\r\n// import DataContext from './DataContext';\r\n\r\nexport default (container, dataContext) => {\r\n    const canvas = createCanvas(document, container);\r\n    const sceneManager = new SceneManager(canvas, dataContext);\r\n\r\n    render();\r\n\r\n    function createCanvas(document, container) {\r\n        const canvas = document.createElement('canvas');  \r\n        canvas.width = container.scrollWidth;\r\n        canvas.height = container.scrollHeight;\r\n        container.appendChild(canvas);\r\n        return canvas;\r\n    }\r\n   \r\n    function render() {\r\n        requestAnimationFrame(render);\r\n        sceneManager.update();\r\n    }\r\n}","export default class FileUtilities {\r\n\r\n  processXLSXIntoCSV(xlsxFile, onComplete) {\r\n    var reader = new FileReader();\r\n    reader.readAsBinaryString(xlsxFile);\r\n    reader.onload = () => {\r\n      var csvSheetStrings = this.transformXLXSIntoCsvStrings(reader.result);\r\n      onComplete(this.parseSingleCSV(csvSheetStrings[0]));\r\n    }\r\n  }\r\n\r\n  processPlotsData(file, onComplete){\r\n    var reader = new FileReader();\r\n    reader.readAsText(file);\r\n    reader.onload = () => {\r\n      let text = reader.result;\r\n      onComplete(JSON.parse(text));\r\n    }\r\n  }\r\n\r\n  transformXLXSIntoCsvStrings(binaryContents) {\r\n    const XLSX = require('xlsx')\r\n    const binaryType = {\r\n      type: 'binary'\r\n    };\r\n    var csvStrings = [];\r\n    var workbook = XLSX.read(binaryContents, binaryType);\r\n    workbook.SheetNames.forEach(name => {\r\n      csvStrings.push(XLSX.utils.sheet_to_csv(workbook.Sheets[name]));\r\n    });\r\n\r\n    return csvStrings;\r\n  }\r\n\r\n  parseSingleCSV(csvString) {\r\n    var numOfRows = 0;\r\n    var numOfColumns = 1;\r\n    var ch, i;\r\n    //Count rows\r\n    for (i = 0; i < csvString.length; i++) {\r\n      ch = csvString.charAt(i);\r\n      if (ch === '\\n') {\r\n        numOfRows++\r\n      }\r\n    }\r\n    //Count columns\r\n    ch = '';\r\n    i = 0;\r\n    while (ch !== '\\n') {\r\n      ch = csvString.charAt(i);\r\n      if (ch === ',') {\r\n        numOfColumns++;\r\n      }\r\n      i++;\r\n    }\r\n    //Create 2D array to hold xlsx data\r\n    this.data = new Array(numOfRows);\r\n    for (i = 0; i < numOfRows; i++) {\r\n      this.data[i] = new Array(numOfColumns);\r\n    }\r\n    //Fill array\r\n    for (i = 0; i < this.data.length; i++) {\r\n      var rows = csvString.split(\"\\n\");\r\n      this.data[i] = rows[i].split(\",\");\r\n    }\r\n    //Remove multiple label rows, starting at 1 (after first label row)\r\n    for (i = 1; i < this.data.length; i++){\r\n      if ((this.data[i][0] === \"t\") || (this.data[i][1] === \"-\")) {\r\n        this.data.splice(i, 1);\r\n      }\r\n    }\r\n    return this.data;\r\n  }\r\n}","import React from 'react';\r\nimport FormGroup from 'react-bootstrap/lib/FormGroup';\r\nimport FormControl from 'react-bootstrap/lib/FormControl';\r\nimport ControlLabel from 'react-bootstrap/lib/ControlLabel';\r\nimport FileUtilities from '../lib/FileUtilities';\r\nimport NavItem from 'react-bootstrap/lib/NavItem';\r\n\r\nexport default class FileInput extends NavItem {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.title = this.props.title || \"Upload file\";\r\n    this.processUpload = this.processUpload.bind(this);\r\n    this.state = { callback: this.props.onDone, accept: this.props.accept, plot: this.props.isPlot };\r\n  }\r\n\r\n  hasNoFiles(files){\r\n    return files.length === 0;\r\n  }\r\n\r\n  processUpload(e){\r\n    if(this.state.plot)\r\n      this.readPlots(e.target.files, this.state.callback);\r\n    else\r\n      this.readXLSX(e.target.files, this.state.callback);\r\n  }\r\n\r\n  readPlots(files, callback){\r\n    const call = callback;\r\n    let fileUtil = new FileUtilities();\r\n    if(files.length === 0)\r\n      return;\r\n    fileUtil.processPlotsData(files[0], function(dataString){\r\n       call(dataString);\r\n    });\r\n  }\r\n\r\n  readXLSX(files, callback){\r\n    const call = callback;\r\n    let fileUtil = new FileUtilities();\r\n    if(this.hasNoFiles(files))\r\n      return;\r\n    fileUtil.processXLSXIntoCSV(files[0], function(dataString){\r\n       call(dataString);\r\n    });\r\n  }\r\n\r\n  render () {\r\n      return (\r\n        <FormGroup>\r\n         <ControlLabel htmlFor={this.title} style={{ cursor: \"pointer\" }}>\r\n              {this.title}\r\n              <FormControl id={this.title}\r\n                           type=\"file\" \r\n                           accept={this.accept}\r\n                           onChange={this.processUpload} \r\n                           ref={input => {this.fileInput = input;}} \r\n                           style={{ display: \"none\" }} />\r\n          </ControlLabel>\r\n        </FormGroup>\r\n      );\r\n  }\r\n}\r\n        ","export class PlotData {\r\n    constructor(id = \"untracked\") {\r\n        this.id = id;\r\n        this.dataPoints = [];\r\n        this.labels = [];\r\n        this.arrows = [];\r\n        this.step = 0;\r\n        this.fluxMax = 1;\r\n        this.valueMax = 1;\r\n        this.stepDelay = 300;\r\n        this.radius = 40;\r\n        this.color = [70, 156, 150, 1];\r\n        this.skipSteps = 1;\r\n    }\r\n}\r\n\r\nexport default PlotData;","import PlotData from './threejs/PlotData';\r\nimport localforage from 'localforage';\r\n\r\nconst WEB_STORAGE_KEY = \"plots\";\r\n\r\nexport default class LocalStorage {\r\n\r\n    async addNewModelToLocal(modelName){\r\n        let model = this.newModelTemplate(modelName);\r\n        let models = await this.loadModelsFromDefaultContainer();\r\n        models.push(model);\r\n        await this.saveToStore(WEB_STORAGE_KEY, models, \"Failed to add a new model\").catch(() => {return model}); \r\n        return model;\r\n    }\r\n\r\n    async saveToStore(key, value, failureMsg = \"Failed to write to storage\"){\r\n        try {\r\n            await localforage.setItem(key, \"!\" + JSON.stringify(value));\r\n        } catch (error) {\r\n            alert(failureMsg + String(error));\r\n        }\r\n    }\r\n\r\n    async fetchFromStore(key, failureMsg = \"Failed to fetch from storage\"){\r\n        try {\r\n            let result = await localforage.getItem(key);\r\n            if(!result)\r\n                return null;\r\n            return JSON.parse(result.substring(1));\r\n        } catch (error) {\r\n            alert(failureMsg + \": \" + String(error));            \r\n        }\r\n    }\r\n\r\n    //  item must have name of plot\r\n    //  addition must be PlotData\r\n    async updateStorage(name, addition){\r\n        let models = await this.loadModelsFromDefaultContainer();\r\n        for (const modelId in models) {\r\n            if (models.hasOwnProperty(modelId) && models[modelId].name === name) {\r\n                const element = models[modelId];\r\n                let id = element.versions.length + 1;\r\n                addition.id = name + id;\r\n                element.versions = [this.newModelVersion(addition)];\r\n            }\r\n        }\r\n        this.saveToStore(WEB_STORAGE_KEY, models, \"Failed to save the models\");\r\n    }\r\n    \r\n    async removeFromStorage(name){\r\n        let models = await this.loadModelsFromDefaultContainer();\r\n        let reducedList = [];\r\n        for (const modelId in models) {\r\n            if (models.hasOwnProperty(modelId)) {\r\n                if(models[modelId].name !== name){\r\n                    reducedList.push(models[modelId]);\r\n                }\r\n            }\r\n        }\r\n        this.saveToStore(WEB_STORAGE_KEY, reducedList, \"Failed to save the models\");\r\n    }\r\n\r\n    async loadFromStorage() {\r\n        let models = await this.loadModelsFromDefaultContainer();\r\n        if(models.length === 0){\r\n            models.push(this.newModelTemplate());\r\n            this.saveToStore(WEB_STORAGE_KEY, models, \"Failed to save the models\");\r\n        }\r\n        return models;\r\n    }\r\n\r\n    async loadModelsFromDefaultContainer(){\r\n        let models = await this.fetchFromStore(WEB_STORAGE_KEY, \"Failed to Access Memory\").catch();\r\n        if (!models || !models.length) {\r\n            models = [];\r\n        }\r\n        return models;\r\n    }\r\n    \r\n    async writeToLocalStorage(dataArray){\r\n        if (!dataArray || !dataArray.length) {\r\n            dataArray = [];\r\n        }\r\n        await this.saveToStore(WEB_STORAGE_KEY, dataArray);\r\n    }\r\n\r\n    newModelTemplate(name = \"Default Storage\") {\r\n       return {\r\n                name: name,\r\n                versions: [this.newModelVersion(new PlotData(name + \".\" + 1))]\r\n            };\r\n    }\r\n\r\n    newModelVersion(model){\r\n        return {\r\n            plot: model\r\n        }\r\n    }\r\n\r\n}","import React, { Component } from 'react';\r\nimport Navbar from 'react-bootstrap/lib/Navbar';\r\nimport FormGroup from 'react-bootstrap/lib/FormGroup';\r\nimport ControlLabel from 'react-bootstrap/lib/ControlLabel';\r\nimport Form from 'react-bootstrap/lib/Form';\r\nimport FileInput from './FileInput';\r\nimport localStorage from '../lib/LocalStorage';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport { ToastContainer, toast } from 'react-toastify';\r\n\r\nclass Navigation extends Component {\r\n\r\n  constructor(props){\r\n    super(props);\r\n    this.IController = this.props.IController;\r\n    this.dataContext = this.props.dataContext;\r\n\r\n    this.uploadPoints = this.uploadDataPoints.bind(this);\r\n    this.uploadFlux = this.uploadFluxData.bind(this);\r\n    this.processUpload = this.processUpload.bind(this);\r\n  }\r\n\r\n  async downloadLocalStorage(){\r\n    toast(\"Prepping Download\", { \r\n      position: toast.POSITION.TOP_LEFT\r\n    });\r\n    let data = JSON.stringify(await (new localStorage()).loadModelsFromDefaultContainer());\r\n    var blobData = new Blob([data], {type: 'text/plain'});\r\n    let textFile = window.URL.createObjectURL(blobData);\r\n    let downloadAnchorNode = document.createElement('a');\r\n    downloadAnchorNode.setAttribute(\"href\", textFile);\r\n    downloadAnchorNode.setAttribute(\"download\", \"plots.json\");\r\n    document.body.appendChild(downloadAnchorNode);\r\n    downloadAnchorNode.click();\r\n    downloadAnchorNode.remove();\r\n  }\r\n\r\n  processUpload(e){\r\n    this.readPlots(e.target.files);\r\n  }\r\n\r\n  uploadDataPoints(data){\r\n      toast(\"Upload Point Data Complete\", { \r\n        position: toast.POSITION.TOP_LEFT\r\n      });\r\n      this.dataContext.injectDataPointList(data);\r\n  }\r\n\r\n  uploadFluxData(data) {\r\n    toast(\"Upload Flux Data Complete\", { \r\n      position: toast.POSITION.TOP_LEFT\r\n    });\r\n    this.dataContext.injectFluxList(data);\r\n  }\r\n\r\n  async  uploadModels(data) {\r\n    if(data && window.confirm(\"Warning! This will replace all of your models with the uploaded models. Continue?\")){\r\n      await (new localStorage()).writeToLocalStorage(data);\r\n      window.location.reload();\r\n      return;\r\n    }\r\n    toast(\"No Models Uploaded\", { \r\n      position: toast.POSITION.TOP_LEFT\r\n    });\r\n  }\r\n\r\n  render() {\r\n\r\n    let preventRedirect = e => {\r\n      e.preventDefault();\r\n    };\r\n\r\n    return (\r\n        <Navbar inverse id='mainNav'>\r\n          <Navbar.Header>\r\n            <Navbar.Brand className='nav-brand'>\r\n              <a href=\"https://github.com/staujd02/time_machine\">Compartmental Visualizer</a>\r\n            </Navbar.Brand>\r\n          </Navbar.Header>\r\n          <Form inline>\r\n            <FileInput className='nav-item' onDone={this.uploadPoints} isPlot={false} accept=\".xlsx\" onClick={preventRedirect} title={\"Upload Compartment Data\"}/>\r\n            <FileInput className='nav-item' onDone={this.uploadFlux} isPlot={false} accept=\".xlsx\" onClick={preventRedirect} title={\"Upload Flux Data\"}/>\r\n            <FileInput className='nav-item' onDone={this.uploadModels} isPlot={true} accept=\".json\" onClick={preventRedirect} title={\"Upload Models\"}/>\r\n            <FormGroup className='nav-item'>\r\n              <ControlLabel htmlFor=\"Export Models\" style={{ cursor: \"pointer\" }} onClick={this.downloadLocalStorage}>\r\n                    {\"Export Models\"}\r\n                    <ToastContainer autoClose={1500} />\r\n              </ControlLabel>\r\n            </FormGroup>\r\n          </Form>\r\n        </Navbar>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Navigation;","import React, { Component } from 'react';\r\nexport default class SavedPlot extends Component {\r\n\r\n  constructor(param){\r\n    super(param);\r\n    this.dataCapsule = this.props.dataCapsule;\r\n    this.name = this.dataCapsule.name;\r\n    this.className = this.props.className;\r\n  }\r\n\r\n  render() {\r\n    return ( \r\n        <div className={this.className}>{this.name}</div>\r\n    );\r\n  }\r\n}","import React, { Component } from 'react';\r\nimport SavedPlot from './SavedPlot';\r\nimport Button from 'react-bootstrap/lib/Button';\r\nimport LocalStorage from '../lib/LocalStorage';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default class StorageList extends Component {\r\n\r\n  constructor(param){\r\n    super(param);\r\n    const parent = this;\r\n    this.entries = [];\r\n    this.handleClick = this.handleClick.bind(this);\r\n    this.addToLocal = this.addToLocal.bind(this);\r\n    this.removeFromLocal = this.removeFromLocal.bind(this);\r\n    this.loadSaves = this.loadSaves.bind(this);\r\n    this.createButtonEntry = this.createButtonEntry.bind(this);\r\n    this.createEntryName = this.createEntryName.bind(this);\r\n    this.createGrid = this.createGrid.bind(this);\r\n    this.activeModelName = this.activeModelName.bind(this);\r\n    this.state = {dataContext: parent.props.dataContext};\r\n    this.loadSaves();\r\n  }\r\n\r\n  isActive(capsule){\r\n    return this.state.dataContext.currentPlot().id === capsule.versions[capsule.versions.length - 1].plot.id;\r\n  }\r\n\r\n  applyName(capsule){\r\n    return this.isActive(capsule) ? \"Save\" : \"Load\";\r\n  }\r\n\r\n  createButtonEntry(save){\r\n      return <Button key={this.entries.length} className=\"grid-item\" onClick={() => this.handleClick(save)}>{this.applyName(save)}</Button>;\r\n  }\r\n\r\n  createEntryName(save){\r\n      return <SavedPlot key={this.entries.length} className=\"grid-item\" dataCapsule={save}/>;\r\n  }\r\n\r\n  activeModelName(){\r\n    let model = \"\";\r\n    if(this.state.models){\r\n    this.state.models.forEach(s => {\r\n      if(this.isActive(s)){\r\n          model = s.name;\r\n      }\r\n    });\r\n    }\r\n    return \" \" + model;\r\n  }\r\n\r\n  async addToLocal(){\r\n    let resp = this.solictStorageName('you would like to add.');\r\n    if(!!resp){\r\n      await (new LocalStorage()).addNewModelToLocal(resp);\r\n      await this.loadSaves();\r\n      this.forceUpdate();\r\n    }\r\n  }\r\n  \r\n  async removeFromLocal(){\r\n    let resp = this.solictStorageName('you would like to permanently delete.');\r\n    if(!!resp){\r\n      await (new LocalStorage()).removeFromStorage(resp);\r\n      await this.loadSaves();\r\n      this.forceUpdate();\r\n      toast.success(\"Model Removed\");\r\n    }\r\n  }\r\n\r\n  solictStorageName(extension) {\r\n    return window.prompt('Please enter the name of Model ' + extension);\r\n  }\r\n\r\n  async handleClick(s) {\r\n    if(this.isActive(s)){\r\n      let plot = this.state.dataContext.currentPlot();\r\n      await (new LocalStorage()).updateStorage(s.name, plot);\r\n      toast.success(\"Model Saved\");\r\n    } else {\r\n      await this.loadSaves();\r\n      this.state.dataContext.currentPlot(s);\r\n      this.forceUpdate();\r\n    }\r\n  }\r\n\r\n  async loadSaves(){\r\n    this.entries = [];\r\n    let models = await (new LocalStorage()).loadFromStorage(this.ThreeController);\r\n    let dataContext = this.state.dataContext;\r\n    this.setState({\r\n        dataContext: dataContext,\r\n        models: models\r\n    });\r\n  }\r\n\r\n  createGrid(){\r\n    if(this.state.models){\r\n      this.entries = [];\r\n      this.state.models.forEach(s => {\r\n        this.entries.push(this.createEntryName(s));\r\n        this.entries.push(this.createButtonEntry(s));\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n\r\n    this.createGrid();\r\n\r\n    return ( \r\n        <div>\r\n          <h4 className=\"model-list-banner\">Models</h4>\r\n          <h5 className=\"active-banner\"><span>Loaded Model: </span>{this.activeModelName()}</h5>\r\n          <div className=\"grid-container\">\r\n            {this.entries}\r\n          </div>\r\n          <div className=\"grid-container\">\r\n            <Button id=\"new-plot\" onClick={this.addToLocal}>New Model</Button>\r\n            <Button id=\"delete-plot\" onClick={this.removeFromLocal}>Delete Model</Button>\r\n          </div>\r\n        </div>\r\n    );\r\n  }\r\n}","export default (PlotData) => {\r\n\r\n    let context = {};\r\n\r\n    context.plot_id = PlotData.id;\r\n\r\n    context.callbacks = [];\r\n    context.labelMode = false;\r\n    context.onLoad = null;\r\n    context.animationData = null;\r\n    context.fluxData = null;\r\n\r\n    Object.assign(context, PlotData);\r\n\r\n    context.callObservers = () => {\r\n        context.callbacks.forEach(call => {\r\n            call();\r\n        });\r\n    };\r\n\r\n    context.registerCallback = (call) => {\r\n        context.callbacks.push(call);\r\n    };\r\n\r\n    context.currentPlot = (plot = null) => {\r\n        if (plot) {\r\n            return context.loadPlot(plot.versions[plot.versions.length - 1].plot);\r\n        } else {\r\n            return {\r\n                id: context.plot_id,\r\n                dataPoints: context.dataPoints,\r\n                labels: context.labels,\r\n                arrows: context.arrows,\r\n                step: context.step,\r\n                valueMax: context.valueMax,\r\n                fluxMax: context.fluxMax,\r\n                stepDelay: context.stepDelay,\r\n                color: context.color,\r\n                skipSteps: context.skipSteps,\r\n                radius: context.radius\r\n            }\r\n        }\r\n    };\r\n\r\n    context.loadPlot = (plot) => {\r\n        Object.assign(context, plot);\r\n        context.plot_id = plot.id;\r\n        context.callObservers();\r\n        return plot;\r\n    };\r\n\r\n    context.injectDataPointList = json => loadPointData(json, context);\r\n    context.injectFluxList = json => loadFluxData(json, context);\r\n\r\n    context.dataLoaded = function dataLoaded() {\r\n        return context.animationData != null;\r\n    }\r\n\r\n    context.hasNextStep = function hasNextStep() {\r\n        return context.dataLoaded() && context.step < context.animationData.length;\r\n    }\r\n\r\n    return context;\r\n\r\n    function loadFluxData(xlsxData, instance) {\r\n        if (xlsxData.length > 1 && isNaN(xlsxData[1][1])) {\r\n            instance.fluxOriginLabels = xlsxData[0];\r\n            instance.fluxDestinationLabels = xlsxData[1];\r\n            instance.fluxOriginLabels.splice(0, 1);\r\n            instance.fluxDestinationLabels.splice(0, 1);\r\n            xlsxData.splice(0, 1); //Remove extra label column\r\n        }\r\n        xlsxData.splice(0, 1); //Remove label column\r\n        instance.fluxData = xlsxData;\r\n        if (instance.onLoad && typeof instance.onLoad === \"function\")\r\n            instance.onLoad();\r\n    }\r\n\r\n    function loadPointData(xlsxData, instance) {\r\n        instance.labels = xlsxData[0];\r\n        xlsxData.splice(0, 1); //Remove label column\r\n        instance.animationData = xlsxData;\r\n        if (instance.onLoad && typeof instance.onLoad === \"function\")\r\n            instance.onLoad();\r\n    }\r\n\r\n}","import React, { Component } from 'react';\r\nimport './css/App.css';\r\nimport ThreeContainer from './components/ThreeContainer';\r\nimport Navigation from './components/Navigation';\r\nimport StorageList from './components/StorageList.js';\r\nimport LocalStorage from './lib/LocalStorage.js';\r\nimport Grid from 'react-bootstrap/lib/Grid';\r\nimport Row from 'react-bootstrap/lib/Row';\r\nimport Col from 'react-bootstrap/lib/Col';\r\nimport Image from 'react-bootstrap/lib/Image';\r\nimport DataContext from './lib/threejs/DataContext';\r\n\r\nclass App extends Component {\r\n \r\n  constructor(props){\r\n    super(props);\r\n    this.ThreeController = {\r\n      resetDataAnimation: function() {},\r\n      onLoad: function() {},\r\n      onFluxLoad: function() {}\r\n    };\r\n    this.fetchSaves()\r\n  }\r\n\r\n  async fetchSaves(){\r\n    let saves = await ((new LocalStorage()).loadFromStorage(this.ThreeController));\r\n    console.log(saves);\r\n    let currentPlot = saves[0].versions[saves[0].versions.length - 1].plot;\r\n    let currentContext = new DataContext(currentPlot);\r\n    this.setState({\r\n      saves: saves,\r\n      currentPlot: currentPlot,\r\n      currentContext: currentContext\r\n    });\r\n  }\r\n\r\n  render() {\r\n    if(!this.state || !this.state.currentContext)\r\n      return (<div>Loading From Storage</div>);\r\n\r\n    return (\r\n      <div className=\"app\">\r\n            <Grid fluid={true} className='fill'>\r\n              <Row>\r\n                  <Navigation dataContext={this.state.currentContext} IController={this.ThreeController} />\r\n              </Row>\r\n              <Row className='fill'>\r\n                <Col sm={2} md={2} className='sidebar'>\r\n                  <Row sm={2} md={2}>\r\n                    <div className='dat-style' id=\"datGuiAnchor\"></div>\r\n                  </Row>\r\n                  <Row sm={2} md={2}>\r\n                    <StorageList dataContext={this.state.currentContext} saves={this.saves}></StorageList>\r\n                  </Row>\r\n                  <Image className=\"logo\" src=\"./pfw-white.png\"></Image>\r\n                </Col>\r\n                <Col sm={10} md={10} className='threeContainer'> \r\n                  <ThreeContainer dataContext={this.state.currentContext} IController={this.ThreeController}/> \r\n                </Col>\r\n              </Row>\r\n            </Grid>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default App;","// In production, we register a service worker to serve assets from local cache.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on the \"N+1\" visit to a page, since previously\r\n// cached resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model, read https://goo.gl/KwvDNy.\r\n// This link also includes instructions on opting out of this behavior.\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.1/8 is considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\nexport default function register() {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebookincubator/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Lets check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://goo.gl/SC7cgQ'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not local host. Just register service worker\r\n        registerValidSW(swUrl);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the old content will have been purged and\r\n              // the fresh content will have been added to the cache.\r\n              // It's the perfect time to display a \"New content is\r\n              // available; please refresh.\" message in your web app.\r\n              console.log('New content is available; please refresh.');\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl)\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      if (\r\n        response.status === 404 ||\r\n        response.headers.get('content-type').indexOf('javascript') === -1\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready.then(registration => {\r\n      registration.unregister();\r\n    });\r\n  }\r\n}\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './css/index.css';\r\nimport './css/bootstrap.min.css';\r\nimport App from './App';\r\nimport registerServiceWorker from './registerServiceWorker';\r\n\r\nReactDOM.render(<App />, document.getElementById('root'));\r\nregisterServiceWorker();\r\n"],"sourceRoot":""}