(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(t,e,a){},109:function(t,e,a){},112:function(t,e,a){},188:function(t,e){},189:function(t,e){},201:function(t,e,a){"use strict";a.r(e);var n=a(0),s=a.n(n),i=a(62),o=a.n(i),r=(a(108),a(109),a(2)),h=a.n(r),l=a(7),c=a(3),d=a(4),u=a(18),p=a(16),m=a(17),x=(a(112),a(1)),f=a(68),v=40,b=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Object(c.a)(this,t);var n=!!a;this.dataIndex=e,this.labelText="",this.baseColor=n?a.baseColor:"#aa00ff",this.radius=v,this.shadowMargin=7,this.shadowMargin=n?a.shadowMargin:7,this.shadowPushBack=1,this.textPullForward=-5,this.shadow={},this.shadow.geometry=new x.d(this.radius+this.shadowMargin,32),this.shadow.mesh=new x.g(this.shadow.geometry),this.shadow.mesh.material=new x.h({color:"#cccccc"}),this.object={},this.object.geometry=new x.d(this.radius,32),this.object.mesh=new x.g(this.object.geometry),this.object.mesh.material=new x.h({color:this.baseColor}),this.object.mesh.position.set(0,0,0),this.shadow.mesh.position.set(0,0,this.shadowPushBack),this.position=this.object.mesh.position,this.shadow.position=this.shadow.mesh.position,this.object.scale=this.object.mesh.scale,this.shadow.scale=this.shadow.mesh.scale,n&&(this.adjustScale(a.radius),this.object.mesh.position.set(a.position.x,a.position.y,a.position.z),this.shadow.mesh.position.set(a.shadow.position.x,a.shadow.position.y,a.shadow.position.z)),this.withinCircle=this.withinCircle.bind(this),this.adjustScale=this.adjustScale.bind(this),this.appendText=this.appendText.bind(this),this.moveText=this.moveText.bind(this),this.moveIndexText=this.moveIndexText.bind(this),this.setPosition=this.setPosition.bind(this),this.changeTextSize=this.changeTextSize.bind(this),this.changeIndexTextSize=this.changeIndexTextSize.bind(this),this.transformColor=this.transformColor.bind(this),this.changeColor=this.changeColor.bind(this),this.lightenColor=this.lightenColor.bind(this),this.darkenColor=this.darkenColor.bind(this),this.showIndex=this.showIndex.bind(this),this.update=this.update.bind(this)}return Object(d.a)(t,[{key:"update",value:function(){}},{key:"withinCircle",value:function(t,e){var a=this.object.mesh.position;return!(Math.sqrt((t-a.x)*(t-a.x)+(e-a.y)*(e-a.y))>this.radius)}},{key:"adjustScale",value:function(t){this.radius=t;var e=this.radius/v;this.object.scale.set(e,e,e),this.shadow.scale.set(e,e,e)}},{key:"appendText",value:function(t,e,a,n){this.labelText=e;var s=new x.k(e,{font:t,size:13,height:5,curveSegments:12,bevelEnabled:!1,bevelThickness:1,bevelSize:2,bevelSegments:5}),i=new x.h({color:0});this.textMesh=new x.g(s,i),this.moveText(a,n),this.textMesh.rotation.set(0,0,Math.PI),this.changeTextSize(this.radius)}},{key:"moveText",value:function(t,e){var a=(new x.b).setFromObject(this.textMesh);this.textMesh.position.set(t+.5*(a.max.x-a.min.x),e,this.textPullForward)}},{key:"moveIndexText",value:function(t,e){var a=(new x.b).setFromObject(this.indexTextMesh);this.indexTextMesh.position.set(t+.5*(a.max.x-a.min.x),e,this.textPullForward)}},{key:"setPosition",value:function(t,e,a){this.position.set(t,e,a),this.shadow.position.set(t,e,this.shadowPushBack)}},{key:"changeTextSize",value:function(t){var e=t/v;this.textMesh.scale.set(e,e,e+this.textPullForward)}},{key:"changeIndexTextSize",value:function(t){var e=t/v;this.indexTextMesh.scale.set(e,e,e+this.textPullForward)}},{key:"transformColor",value:function(t){return f({r:t[0],g:t[1],b:t[2]}).toHexString()}},{key:"changeColor",value:function(t){this.baseColor=this.transformColor(t),this.object.mesh.material.color.set(this.baseColor.toString())}},{key:"lightenColor",value:function(t){this.object.mesh.material.color.set(f(this.baseColor).lighten(t).toString())}},{key:"darkenColor",value:function(t){this.object.mesh.material.color.set(f(this.baseColor).darken(t).toString())}},{key:"showIndex",value:function(t){var e=new x.k(this.dataIndex.toString(),{font:t,size:10,height:5,curveSegments:12,bevelEnabled:!1,bevelThickness:1,bevelSize:2,bevelSegments:5}),a=new x.h({color:8421504});this.indexTextMesh=new x.g(e,a),this.moveIndexText(this.position.x,this.position.y+.75*this.radius),this.indexTextMesh.rotation.set(0,0,Math.PI),this.changeIndexTextSize(this.radius)}}]),t}(),g=500,w=function(){function t(e,a){Object(c.a)(this,t),this.fontResource=e,this.stepLength=0,this.yPos=a,this.bar={},this.progress={},this.start={},this.stop={},this.bar.geometry=new x.c(g,20,1),this.bar.mesh=new x.g(this.bar.geometry),this.bar.mesh.material=new x.h({color:"#afafaf"}),this.progressLength=0,this.progress.geometry=new x.c(this.progressLength,20,1),this.progress.mesh=new x.g(this.progress.geometry),this.progress.mesh.material=new x.h({color:"#666666"}),this.bar.mesh.position.set(0,this.yPos,0),this.progress.mesh.position.set((g-this.progressLength)/2,this.yPos,0),this.updateProgress=this.updateProgress.bind(this),this.createText=this.createText.bind(this),this.createTitle=this.createTitle.bind(this),this.moveText=this.moveText.bind(this),this.withinBar=this.withinBar.bind(this),this.getStep=this.getStep.bind(this),this.setSteps=this.setSteps.bind(this),this.getBar=this.getBar.bind(this)}return Object(d.a)(t,[{key:"updateProgress",value:function(t,e,a,n){this.stepLength*t<=g&&(this.progressLength=this.stepLength*t,this.progress.mesh.geometry=new x.c(this.progressLength,20,1),this.progress.mesh.position.set((g-this.progressLength)/2+a,this.yPos+n,0),this.createText(e,a,n))}},{key:"createText",value:function(t,e,a){var n=new x.k(t,{font:this.fontResource,size:10,height:5,curveSegments:12,bevelEnabled:!1,bevelThickness:1,bevelSize:2,bevelSegments:5}),s=new x.h({color:0});this.textMesh=new x.g(n,s),this.textMesh.position.set(250-this.progressLength+e,this.yPos+25+a,0),this.textMesh.rotation.set(0,0,Math.PI)}},{key:"createTitle",value:function(){var t=new x.k("Progress Bar:",{font:this.fontResource,size:10,height:5,curveSegments:12,bevelEnabled:!1,bevelThickness:1,bevelSize:2,bevelSegments:5}),e=new x.h({color:0});this.titleTextMesh=new x.g(t,e),this.titleTextMesh.position.set(350,this.yPos+7,0),this.titleTextMesh.rotation.set(0,0,Math.PI)}},{key:"moveText",value:function(t,e){var a=(new x.b).setFromObject(this.textMesh);this.textMesh.position.set(t+.5*(a.max.x-a.min.x),e,0)}},{key:"withinBar",value:function(t,e){return e<this.yPos+10&&e>this.yPos-10&&(t<250&&t>-250)}},{key:"getStep",value:function(t){var e=250-t;return Math.round(e/this.stepLength)}},{key:"setSteps",value:function(t){this.stepLength=g/t}},{key:"getBar",value:function(){return this.progress.mesh}}]),t}(),C=40,k=a(68),y=function(){function t(e,a){Object(c.a)(this,t),this.arrowInfo=e,this.arrowInfo.dataIndex=void 0!==e.dataIndex?e.dataIndex:a,this.arrowLength=e.dataPointRadius/C*22,this.arrowWidth=e.dataPointRadius/C*15,this.textPullForward=-5,this.baseColor="#222222",this.object={},this.dir=this.calculateDir(),this.dir.normalize(),this.length=this.calculateLength(),this.position=this.calculatePos(),this.calculateLength=this.calculateLength.bind(this),this.calculateDir=this.calculateDir.bind(this),this.calculatePos=this.calculatePos.bind(this),this.lightenColor=this.lightenColor.bind(this),this.darkenColor=this.darkenColor.bind(this),this.updatePos=this.updatePos.bind(this),this.setLength=this.setLength.bind(this),this.delete=this.delete.bind(this),this.adjustScale=this.adjustScale.bind(this),this.showIndex=this.showIndex.bind(this),this.changeIndexTextSize=this.changeIndexTextSize.bind(this),this.moveIndexText=this.moveIndexText.bind(this),this.object=new x.a(this.dir,this.position,this.length,this.baseColor,this.arrowLength,this.arrowWidth)}return Object(d.a)(t,[{key:"calculateLength",value:function(){var t=Math.sqrt((this.arrowInfo.point2.x-this.arrowInfo.point1.x)*(this.arrowInfo.point2.x-this.arrowInfo.point1.x)+(this.arrowInfo.point2.y-this.arrowInfo.point1.y)*(this.arrowInfo.point2.y-this.arrowInfo.point1.y));return t-=3*this.arrowInfo.dataPointRadius}},{key:"calculateDir",value:function(){return new x.l(this.arrowInfo.point2.x-this.arrowInfo.point1.x,this.arrowInfo.point2.y-this.arrowInfo.point1.y,0)}},{key:"calculatePos",value:function(){var t=new x.l(1.5*this.arrowInfo.dataPointRadius*this.dir.x,1.5*this.arrowInfo.dataPointRadius*this.dir.y,0),e=this.arrowInfo.dataPointRadius/3.5;this.arrowInfo.shift&&(this.dir.x-this.dir.y>=0?this.dir.y<=-.5?t.x+=e:t.y+=e:this.dir.y>=.5?t.x+=e:t.y+=e);return new x.l(this.arrowInfo.point1.x+t.x,this.arrowInfo.point1.y+t.y,0)}},{key:"lightenColor",value:function(t){var e=k(this.baseColor).lighten(t).toString();this.object=new x.a(this.dir,this.position,this.length,e,this.arrowLength,this.arrowWidth)}},{key:"darkenColor",value:function(t){var e=k(this.baseColor).darken(t).toString();this.object=new x.a(this.dir,this.position,this.length,e,this.arrowLength,this.arrowWidth)}},{key:"updatePos",value:function(t,e){this.arrowInfo.point1=t,this.arrowInfo.point2=e,this.dir=this.calculateDir(),this.dir.normalize(),this.length=this.calculateLength(),this.position=this.calculatePos(),this.object.setLength(this.length,this.arrowLength,this.arrowWidth),this.object.setDirection(this.dir),this.object.position.set(this.position.x,this.position.y,0)}},{key:"setLength",value:function(t){this.object.setLength(t)}},{key:"delete",value:function(){this.scene.remove(this.object)}},{key:"adjustScale",value:function(t){this.arrowInfo.dataPointRadius=t,this.arrowLength=this.arrowInfo.dataPointRadius/C*22,this.arrowWidth=this.arrowInfo.dataPointRadius/C*15,this.updatePos(this.arrowInfo.point1,this.arrowInfo.point2)}},{key:"showIndex",value:function(t){var e=new x.k(this.arrowInfo.dataIndex.toString(),{font:t,size:10,height:5,curveSegments:12,bevelEnabled:!1,bevelThickness:1,bevelSize:2,bevelSegments:5}),a=new x.h({color:8421504});this.indexTextMesh=new x.g(e,a),this.moveIndexText(this.position.x,this.position.y),this.indexTextMesh.rotation.set(0,0,Math.PI)}},{key:"changeIndexTextSize",value:function(t){var e=t/this.origLength;e=0===e?e=1e-4:e,this.indexTextMesh.scale.set(e,e,e+this.textPullForward)}},{key:"moveIndexText",value:function(t,e){var a=(new x.b).setFromObject(this.indexTextMesh);this.indexTextMesh.position.set(t+.5*(a.max.x-a.min.x),e,this.textPullForward)}}]),t}(),M=function(){function t(e,a){Object(c.a)(this,t);var n={width:e.width,height:e.height};this.dataContext=a,this.dataContext.origin=new x.l(0,0,0),this.loadFont(this.fontLoadingComplete.bind(this)),this.canvas=e,this.scene=this.buildScene(),this.renderer=this.buildRender(n,e),this.camera=this.buildCamera(n,this.dataContext),this.registerCallbacks(this.dataContext,this.scene,this.reloadScene),this.update=this.update.bind(this),this.reloadScene=this.reloadScene.bind(this),this.reloadCompartments=this.reloadCompartments.bind(this),this.reloadArrows=this.reloadArrows.bind(this),this.buildProgressBar=this.buildProgressBar.bind(this),this.changeAllRadius=this.changeAllRadius.bind(this),this.changeColor=this.changeColor.bind(this),this.updateArrows=this.updateArrows.bind(this),this.addFluxArrow=this.addFluxArrow.bind(this),this.removeFromScene=this.removeFromScene.bind(this),this.addCompartment=this.addCompartment.bind(this),this.addArrow=this.addArrow.bind(this),this.renameCompartment=this.renameCompartment.bind(this),this.updateCompartmentIndexText=this.updateCompartmentIndexText.bind(this),this.generateCompartments=this.generateCompartments.bind(this),this.showCompartmentIndexText=this.showCompartmentIndexText.bind(this),this.hideCompartmentIndexText=this.hideCompartmentIndexText.bind(this),this.showFluxIndexText=this.showFluxIndexText.bind(this),this.hideFluxIndexText=this.hideFluxIndexText.bind(this),this.updateProgressBar=this.updateProgressBar.bind(this),this.colorPoints=this.colorPoints.bind(this),this.moveCamera=this.moveCamera.bind(this),this.canvasToThreePos=this.canvasToThreePos.bind(this),this.moveProgressBar=this.moveProgressBar.bind(this)}return Object(d.a)(t,[{key:"updateProgressBar",value:function(t,e){this.dataContext.progressBar.textMesh&&this.scene.remove(this.dataContext.progressBar.textMesh),this.dataContext.progressBar.updateProgress(t,e,this.camera.position.x,this.camera.position.y),this.scene.add(this.dataContext.progressBar.textMesh)}},{key:"showCompartmentIndexText",value:function(t){t.showIndex(this.dataContext.fontResource),this.scene.add(t.indexTextMesh)}},{key:"hideCompartmentIndexText",value:function(t){this.scene.remove(t.indexTextMesh)}},{key:"showFluxIndexText",value:function(t){t.showIndex(this.dataContext.fontResource),this.scene.add(t.indexTextMesh)}},{key:"hideFluxIndexText",value:function(t){this.scene.remove(t.indexTextMesh)}},{key:"renameCompartment",value:function(t,e){this.scene.remove(t.textMesh),t.appendText(this.dataContext.fontResource,e,t.position.x,t.position.y),this.scene.add(t.textMesh)}},{key:"updateCompartmentIndexText",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.scene.remove(t.indexTextMesh),e&&(t.showIndex(this.dataContext.fontResource),this.scene.add(t.indexTextMesh))}},{key:"loadFont",value:function(t){(new x.f).load("https://threejs.org//examples/fonts/helvetiker_regular.typeface.json",t)}},{key:"fontLoadingComplete",value:function(t){this.dataContext.fontResource=t,this.reloadScene()}},{key:"buildScene",value:function(){var t=new x.j;return t.background=new x.e("#FFF"),t}},{key:"buildRender",value:function(t,e){var a=t.width,n=t.height,s=new x.m({canvas:e,antialias:!0,alpha:!0}),i=window.devicePixelRatio?window.devicePixelRatio:1;return s.setPixelRatio(i),s.setSize(a,n),s.gammaInput=!0,s.gammaOutput=!0,s}},{key:"buildCamera",value:function(t,e){var a=t.width,n=t.height,s=new x.i(a/-2,a/2,n/-2,n/2,1,1e3);return s.position.set(0,0,-10),s.lookAt(e.origin),s}},{key:"moveCamera",value:function(t,e){this.camera.position.x+=t,this.camera.position.y+=e,this.moveProgressBar(t,e)}},{key:"moveProgressBar",value:function(t,e){for(var a=[this.dataContext.progressBar.textMesh,this.dataContext.progressBar.titleTextMesh,this.dataContext.progressBar.bar.mesh,this.dataContext.progressBar.progress.mesh],n=0;n<a.length;n++)a[n].position.x+=t,a[n].position.y+=e}},{key:"registerCallbacks",value:function(t,e,a){t.onFluxLoad=function(){},t.onLoad=function(){null!=t.animationData&&(t.progressBar.textMesh&&e.remove(t.progressBar.textMesh),t.progressBar.createText(t.animationData[0][0]),t.progressBar.setSteps(t.animationData.length),e.add(t.progressBar.textMesh))},t.registerCallback(a.bind(this))}},{key:"reloadScene",value:function(){this.clearScene(this.scene),this.reloadCompartments(),this.reloadArrows(),this.buildProgressBar()}},{key:"clearScene",value:function(t){var e=[];t.traverse(function(t){(t instanceof x.g||t instanceof x.a)&&e.push(t)});for(var a=0;a<e.length;a++)t.remove(e[a])}},{key:"reloadArrows",value:function(){var t=this,e=[],a=0;this.dataContext.arrows.forEach(function(n){e.push(t.restoreArrow(n,a++,t.scene))}),this.dataContext.arrows=e}},{key:"canvasToThreePos",value:function(t){var e,a,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=this.canvas.getBoundingClientRect();return e=s.width/2-t.x+this.camera.position.x,a=t.y-s.height/2+this.camera.position.y,n&&(e-=this.camera.position.x,a-=this.camera.position.y),{x:e,y:a}}},{key:"reloadCompartments",value:function(){var t=this,e=[],a=0;this.dataContext.compartments.forEach(function(n){n.dataIndex||(n.dataIndex=a++);var s=t.restoreCompartment(n,t.scene,t.dataContext);e.push(s),s.moveText(s.object.mesh.position.x,s.object.mesh.position.y)}),this.dataContext.compartments=e}},{key:"buildProgressBar",value:function(){var t=this.canvas.getBoundingClientRect();this.dataContext.progressBar=new w(this.dataContext.fontResource,-t.height/2+25),this.scene.add(this.dataContext.progressBar.bar.mesh),this.scene.add(this.dataContext.progressBar.progress.mesh),null!==this.dataContext.progressBar.textMesh&&this.scene.remove(this.dataContext.progressBar.textMesh),this.dataContext.progressBar.createText("0"),this.scene.add(this.dataContext.progressBar.textMesh),this.dataContext.progressBar.createTitle(),this.scene.add(this.dataContext.progressBar.titleTextMesh)}},{key:"restoreArrow",value:function(t,e,a){var n=new y(t.arrowInfo,e);return a.add(n.object),n}},{key:"restoreCompartment",value:function(t,e,a){var n=new b(t.dataIndex,t);e.add(n.object.mesh),e.add(n.shadow.mesh);var s=t.textMesh?t.textMesh.geometries[0].text:" ";return s||(s=" "),n.appendText(a.fontResource,s,n.position.x,n.position.y),e.add(n.textMesh),n}},{key:"addCompartment",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=this.dataContext.compartments,n=new b(a.length+1);this.scene.add(n.object.mesh),this.scene.add(n.shadow.mesh),e&&(n.showIndex(this.dataContext.fontResource),this.scene.add(n.indexTextMesh)),n.changeColor(this.dataContext.baseColor),n.adjustScale(this.dataContext.radius),n.appendText(this.dataContext.fontResource,t,n.position.x,n.position.y),this.scene.add(n.textMesh),a.push(n),n.setPosition(0,0,0),n.moveText(0,0)}},{key:"addArrow",value:function(){for(var t=this.dataContext.arrows,e=this.dataContext,a=!1,n=0;n<t.length;n++){if(t[n].arrowInfo.pointIndex1===e.arrowPoints[0]&&t[n].arrowInfo.pointIndex2===e.arrowPoints[1])return;t[n].arrowInfo.pointIndex1===e.arrowPoints[1]&&t[n].arrowInfo.pointIndex2===e.arrowPoints[0]&&(a=!0)}this.addFluxArrow({shift:a,len:200,pointIndex1:e.arrowPoints[0],pointIndex2:e.arrowPoints[1],point1:e.compartments[e.arrowPoints[0]].position,point2:e.compartments[e.arrowPoints[1]].position,dataPointRadius:e.radius,dataIndex:e.arrows.length+1})}},{key:"removeFromScene",value:function(t){this.scene.remove(t.object.mesh),this.scene.remove(t.shadow.mesh),this.scene.remove(t.textMesh)}},{key:"addFluxArrow",value:function(t){var e=this.dataContext.arrows;this.dataContext.arrowMode=0;var a=new y(t);this.scene.add(a.object),e.push(a)}},{key:"updateArrows",value:function(t){for(var e=this.dataContext.arrows,a=0;a<e.length;a++){var n=e[a].arrowInfo.pointIndex1,s=e[a].arrowInfo.pointIndex2;n===t||s===t?(this.scene.remove(e[a].object),e.splice(a,1),a--):(n>t&&-1!==t&&(n--,e[a].arrowInfo.pointIndex1--),s>t&&-1!==t&&(s--,e[a].arrowInfo.pointIndex2--),e[a].updatePos(this.dataContext.compartments[n].position,this.dataContext.compartments[s].position),this.dataContext.showIndices()&&e[a].moveIndexText(e[a].position.x,e[a].position.y))}}},{key:"changeColor",value:function(t){this.dataContext.color=t;for(var e=0;e<this.dataContext.compartments.length;e++)this.dataContext.compartments[e].changeColor(t)}},{key:"colorPoints",value:function(){for(var t,e=this.dataContext,a=0;a<e.compartments.length;a++)e.animationData[e.step][e.compartments[a].dataIndex]>e.halfQuantity?(t=(e.animationData[e.step][e.compartments[a].dataIndex]-e.halfQuantity)/e.halfQuantity,e.compartments[a].darkenColor(50*t)):(t=(e.halfQuantity-e.animationData[e.step][e.compartments[a].dataIndex])/e.halfQuantity,e.compartments[a].lightenColor(50*t));if(null!=e.fluxData)for(var n=0;n<e.arrows.length-1;n++)e.fluxData[e.step][e.arrows[n].arrowInfo.dataIndex]>e.halfFlux?(t=(e.fluxData[e.step][e.arrows[n].arrowInfo.dataIndex]-e.halfFlux)/e.halfFlux,this.scene.remove(e.arrows[n].object),e.arrows[n].darkenColor(50*t),this.scene.add(e.arrows[n].object)):(t=(e.halfFlux-e.fluxData[e.step][e.arrows[n].arrowInfo.dataIndex])/e.halfFlux,this.scene.remove(e.arrows[n].object),e.arrows[n].lightenColor(50*t),this.scene.add(e.arrows[n].object))}},{key:"generateCompartments",value:function(t){var e=this.dataContext;if(null!=e.animationData)if(e.compartments.length>0)alert("Compartments already exist");else for(var a=this.canvas.getBoundingClientRect(),n=(a.width-(e.animationData[0].length-1)*(2*e.radius)-2*e.radius)/(e.animationData[0].length-2),s=1;s<e.animationData[0].length;s++){var i=s-1,o=-(a.width/2-e.radius)+i*e.radius*2+i*n+e.radius,r=e.labels[s]?e.labels[s]:s.toString();this.addCompartment(r,t),e.compartments[i].setPosition(-o,-1,0),e.compartments[i].moveText(-o,0),t&&e.compartments[i].moveIndexText(-o,.75*e.compartments[i].radius)}else alert("Compartment data must be uploaded first")}},{key:"changeAllRadius",value:function(){for(var t,e=0;e<this.dataContext.compartments.length;e++)(t=this.dataContext.compartments[e]).adjustScale(this.dataContext.radius),t.changeTextSize(this.dataContext.radius),t.moveText(t.object.mesh.position.x,t.object.mesh.position.y);for(var a=0;a<this.dataContext.arrows.length;a++)this.dataContext.arrows[a].adjustScale(this.dataContext.radius)}},{key:"update",value:function(){this.renderer.render(this.scene,this.camera)}}]),t}(),P=a(93),S=function(){function t(e){Object(c.a)(this,t),this.gui=new P.a({autoPlace:!1}),this.createHTMLElement(this.gui),this.createMenu.bind(this)(this.gui,e),this.updateDisplay=this.gui.updateDisplay}return Object(d.a)(t,[{key:"createHTMLElement",value:function(t){document.getElementById("datGuiAnchor").appendChild(t.domElement),t.domElement.id="datGuiAnchor"}},{key:"createMenu",value:function(t,e){t.add(e.controls,"seekHelp").name("Help"),this.buildAnimationFolder(t.addFolder("Animation"),e),this.buildEditingFolder(t.addFolder("Model Editing"),e),this.buildInterpretationFolder(t.addFolder("Interpretation"),e)}},{key:"buildAnimationFolder",value:function(t,e){return t.add(e.controls,"singleStep").name("Step - -- -- -| \u21e5"),t.add(e.controls,"startStepping").name("Start - -- -- -| \u25b6"),t.add(e.controls,"pauseAnimation").name("Pause - -- -| \u23f8"),t.add(e.controls,"resetAnimation").name("Reset - --- -| \u21bb"),t.add(e.controls,"stepDelay").name("Delay (in ms)").min(0).max(500).step(10).onChange(e.stepDelayCallback),t.add(e.controls,"skipSteps").name("Step Size").onChange(e.skipStepsCallback),t}},{key:"buildEditingFolder",value:function(t,e){return t.add(e.controls,"generateCompartments").name("Generate Comps."),t.add(e.controls,"generateFluxArrows").name("Generate Flux."),t.add(e.controls,"editMode").name("Edit Mode").onChange(e.editModeCallback),t.add(e.controls,"labelMode").name("Import Labels").onChange(e.labelModeCallback),t.add(e.controls,"showIndices").name("Show Indices").onChange(e.showIndicesCallback),t.add(e.controls,"compIndex").name("Data Index").listen().onFinishChange(e.compIndexCallback),t.add(e.controls,"label").name("Comp. Label").listen().onFinishChange(e.labelCallback),t.add(e.controls,"addPoint").name("Add Compartment"),t.add(e.controls,"addArrow").name("Add Arrow"),t.add(e.controls,"deletePoint").name("Delete Compartment"),t.add(e.controls,"size").name("Size").min(10).max(100).step(1).onChange(e.sizeCallback),t}},{key:"buildInterpretationFolder",value:function(t,e){return t.add(e.controls,"valueMax").name("Comp. Maximum").onChange(e.valueMaxCallback),t.add(e.controls,"fluxMax").name("Flux Maximum").onChange(e.fluxMaxCallback),t.addColor(e.controls,"color").name("50% Max Color").onChange(e.colorCallback),t}}]),t}(),I=new(function(){function t(){Object(c.a)(this,t)}return Object(d.a)(t,[{key:"sleep",value:function(t){return new Promise(function(e){return setTimeout(e,t)})}}]),t}()),j=function(){function t(e,a){var n=this;Object(c.a)(this,t),this.dataContext=e,this.sceneManager=a,this.controls=this.createControls.bind(this)(e),this.callbacks=this.createCallbacks(this),this.dataContext.showIndices=function(){return n.controls.showIndices},this.dataContext.updateDisplay=function(t,e){n.controls.compIndex=t,n.controls.label=e}}return Object(d.a)(t,[{key:"createControls",value:function(t){return this.bindControllerFunctions(this),{size:t.radius,valueMax:t.valueMax,fluxMax:t.fluxMax,stepDelay:t.stepDelay,color:t.color,skipSteps:t.skipSteps,generateCompartments:this.generateCompartments.bind(this),generateFluxArrows:this.generateFluxArrows.bind(this),seekHelp:this.seekHelp.bind(this),singleStep:this.singleStep.bind(this),startStepping:this.startStepping.bind(this),pauseAnimation:this.pauseAnimation.bind(this),resetAnimation:this.reset.bind(this),addPoint:this.addPoint.bind(this),addArrow:this.addArrow.bind(this),deletePoint:this.deletePoint.bind(this),showIndices:!1,compIndex:"",label:"",editMode:!1,labelMode:!1}}},{key:"bindControllerFunctions",value:function(t){t.singleStep=t.singleStep.bind(t),t.generateCompartments=t.generateCompartments.bind(t),t.generateFluxArrows=t.generateFluxArrows.bind(t),t.startStepping=t.startStepping.bind(t),t.pauseAnimation=t.pauseAnimation.bind(t),t.resetAnimation=t.reset.bind(t),t.addPoint=t.addPoint.bind(t),t.addCompartment=t.addCompartment.bind(t),t.addArrow=t.addArrow.bind(t),t.deletePoint=t.deletePoint.bind(t),t.isDataLoaded=t.isDataLoaded.bind(t),t.applyStep=t.applyStep.bind(t),t.stepForward=t.stepForward.bind(t),t.deleteDataPoint=t.deleteDataPoint.bind(t)}},{key:"createCallbacks",value:function(t){t.stepDelayCallback=this.stepDelayCallback.bind(this),t.editModeCallback=this.editModeCallback.bind(this),t.skipStepsCallback=this.skipStepsCallback.bind(this),t.labelModeCallback=this.labelModeCallback.bind(this),t.showIndicesCallback=this.showIndicesCallback.bind(this),t.compIndexCallback=this.compIndexCallback.bind(this),t.labelCallback=this.labelCallback.bind(this),t.sizeCallback=this.sizeCallback.bind(this),t.valueMaxCallback=this.valueMaxCallback.bind(this),t.fluxMaxCallback=this.fluxMaxCallback.bind(this),t.colorCallback=this.colorCallback.bind(this)}},{key:"colorCallback",value:function(t){this.dataContext.baseColor=t,this.sceneManager.changeColor(t)}},{key:"fluxMaxCallback",value:function(t){this.dataContext.fluxMax=t,this.dataContext.halfFlux=this.dataContext.fluxMax/2}},{key:"valueMaxCallback",value:function(t){this.dataContext.valueMax=t,this.dataContext.halfQuantity=this.dataContext.valueMax/2}},{key:"sizeCallback",value:function(t){this.dataContext.radius=t,this.sceneManager.changeAllRadius()}},{key:"labelCallback",value:function(t){this.sceneManager.renameCompartment(this.dataContext.compartments[this.dataContext.userSelectedDataPoint],t)}},{key:"compIndexCallback",value:function(t){if(-1!==this.dataContext.userSelectedDataPoint)if(t>this.dataContext.compartments.length||t<1)alert("Invalid Index");else{var e=this.dataContext.compartments[this.dataContext.userSelectedDataPoint];e.dataIndex=t,this.sceneManager.updateCompartmentIndexText(e,this.controls.showIndices)}}},{key:"showIndicesCallback",value:function(t){this.revealIndices(t),this.revealIndices=this.revealIndices.bind(this)}},{key:"labelModeCallback",value:function(t){this.dataContext.labelMode=t}},{key:"editModeCallback",value:function(t){this.dataContext.editMode=t}},{key:"skipStepsCallback",value:function(t){this.dataContext.skipSteps=t}},{key:"stepDelayCallback",value:function(t){this.dataContext.stepDelay=t}},{key:"isDataLoaded",value:function(){return this.dataContext&&!this.dataContext.dataLoaded()&&alert("Please import data first"),this.dataContext.dataLoaded()}},{key:"revealIndices",value:function(t){if(t){for(var e=0;e<this.dataContext.compartments.length;e++)this.sceneManager.showCompartmentIndexText(this.dataContext.compartments[e]);for(var a=0;a<this.dataContext.arrows.length;a++)this.sceneManager.showFluxIndexText(this.dataContext.arrows[a])}else{for(var n=0;n<this.dataContext.compartments.length;n++)this.sceneManager.hideCompartmentIndexText(this.dataContext.compartments[n]);for(var s=0;s<this.dataContext.arrows.length;s++)this.sceneManager.hideFluxIndexText(this.dataContext.arrows[s])}}},{key:"deleteDataPoint",value:function(){var t=this.dataContext.userSelectedDataPoint;this.dataContext.userSelectedDataPoint>-1&&(this.sceneManager.removeFromScene(this.dataContext.compartments[this.dataContext.userSelectedDataPoint]),this.dataContext.compartments.splice(this.dataContext.userSelectedDataPoint,1),this.dataContext.userSelectedDataPoint=-1),this.sceneManager.updateArrows(t)}},{key:"applyStep",value:function(){var t=this.dataContext.step<0?"0":this.dataContext.animationData[this.dataContext.step][0];this.dataContext.step>=0&&this.sceneManager.colorPoints(),this.sceneManager.updateProgressBar(this.dataContext.step+1,t)}},{key:"reset",value:function(){this.dataContext.animationData&&(this.dataContext.step=0,this.dataContext.paused=!0,this.sceneManager.updateProgressBar(0,this.dataContext.animationData[0][0]),this.applyStep())}},{key:"addCompartment",value:function(){var t,e=this.dataContext,a=e.labels,n=e.labelMode,s=e.compartments;(t=n&&a.length>s.length+1?a[s.length+1]:n&&a.length<=s.length?window.prompt("Imported data does not contain a column #"+s.length+".\nPlease label your data point: "):window.prompt("Label your data point: "))&&""!==t?this.sceneManager.addCompartment(t,this.controls.showIndices):alert("No label entered")}},{key:"deletePoint",value:function(){this.dataContext.editMode&&this.deleteDataPoint()}},{key:"addArrow",value:function(){this.dataContext.editMode&&(this.dataContext.arrowMode=1)}},{key:"addPoint",value:function(){this.dataContext.editMode&&this.addCompartment()}},{key:"pauseAnimation",value:function(){this.dataContext.paused=!0}},{key:"seekHelp",value:function(){window.open(window.location.href+"help.html","_blank")}},{key:"singleStep",value:function(){this.startStepping(!0)}},{key:"startStepping",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e,a=arguments;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:e=a.length>0&&void 0!==a[0]&&a[0],this.isDataLoaded()&&(this.dataContext.paused=!1,this.stepForward(e));case 2:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"stepForward",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e,a=arguments;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e=a.length>0&&void 0!==a[0]&&a[0],!this.dataContext.hasNextStep()){t.next=8;break}if(this.dataContext.paused){t.next=8;break}return this.applyStep(),this.dataContext.step+=this.controls.skipSteps,t.next=7,I.sleep(this.dataContext.stepDelay);case 7:e||this.stepForward();case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"generateCompartments",value:function(){this.sceneManager.generateCompartments(this.controls.showIndices)}},{key:"generateFluxArrows",value:function(){var t=this.dataContext;if(t.arrows.length>0)alert("Flux Arrows already exist");else if(t.fluxData)if(t.fluxOriginLabels||t.fluxDestinationLabels){if(t.compartments.length<=0)alert("Compartments must be created first for this operation to succeed.");else for(var e=0;e<t.fluxData[0].length&&!(t.fluxDestinationLabels.length-1<e||t.fluxOriginLabels.length-1<e);e++)if(t.fluxDestinationLabels[e]&&t.fluxOriginLabels[e]){t.arrowPoints[0]=null,t.arrowPoints[1]=null;for(var a=0;a<t.compartments.length;a++){var n=t.compartments[a].labelText.toLowerCase().trim();if(n!==t.fluxOriginLabels[e].toLowerCase().trim()){if(n!==t.fluxDestinationLabels[e].toLowerCase().trim());else if(t.arrowPoints[1]=a,null!==t.arrowPoints[0]){this.sceneManager.addArrow();break}}else if(t.arrowPoints[0]=a,null!==t.arrowPoints[1]){this.sceneManager.addArrow();break}}}}else alert("File Format does not support flux arrows. The first row must be the origin compartment and the second row must be the destination compartment.");else alert("Flux data must be uploaded first before automatic generation can take place.")}}]),t}(),T=a(94),D=function(){function t(e,a,n){Object(c.a)(this,t),this.dataContext=a,this.sceneManager=n,this.canvas=e,this.mouseDown=this.mouseDown.bind(this),this.mouseUp=this.mouseUp.bind(this),this.mouseMove=this.mouseMove.bind(this),this.bindLocalFunctions(this),this.setupEventListeners(e,this)}return Object(d.a)(t,[{key:"bindLocalFunctions",value:function(t){t.getMousePos=t.getMousePos.bind(t),t.isDataLoaded=t.isDataLoaded.bind(t),t.checkWithinRange=t.checkWithinRange.bind(t),t.applyStep=t.applyStep.bind(t)}},{key:"mouseDown",value:function(t){this.dataContext.mouseDown=!0,this.checkWithinRange(this.canvas,t)}},{key:"mouseUp",value:function(t){var e=this.dataContext;e.editMode&&(1===e.arrowMode&&(e.arrowMode=2,this.checkWithinRange(this.canvas,t),null!=e.arrowPoints[0]&&null!=e.arrowPoints[1]?this.sceneManager.addArrow():alert("Dragged line was not between two data points"),e.arrowPoints[0]=null,e.arrowPoints[1]=null),e.mouseDown=!1,e.dataPointToMove=-1),e.arrows.length>0&&this.sceneManager.updateArrows(-1)}},{key:"mouseMove",value:function(t){var e=this.dataContext;if(e.editMode&&e.mouseDown){var a=this.getMousePos(this.canvas,t),n=this.sceneManager.canvasToThreePos(a);e.dataPointToMove>-1&&(e.compartments[e.dataPointToMove].setPosition(n.x,n.y,0),e.compartments[e.dataPointToMove].moveText(n.x,n.y),e.showIndices()&&e.compartments[e.dataPointToMove].moveIndexText(n.x,n.y+.75*e.compartments[e.dataPointToMove].radius))}}},{key:"setupEventListeners",value:function(t,e){t.addEventListener("mousedown",e.mouseDown),t.addEventListener("mouseup",e.mouseUp),t.addEventListener("mousemove",e.mouseMove)}},{key:"getMousePos",value:function(t,e){var a=t.getBoundingClientRect();return{x:e.clientX-a.left,y:e.clientY-a.top}}},{key:"checkWithinRange",value:function(t,e){var a=this.sceneManager.canvasToThreePos(this.getMousePos(t,e)),n=this.sceneManager.canvasToThreePos(this.getMousePos(t,e),!0);this.dataContext.updateDisplay("","");var s=this.dataContext;if(s.editMode)for(var i=0;i<s.compartments.length;i++){var o=s.compartments[i].withinCircle(a.x,a.y);if(o&&1===s.arrowMode)s.compartments[i].shadow.mesh.material.color.set("#ffff00"),s.arrowPoints[0]=i;else if(o&&2===s.arrowMode)s.compartments[i].shadow.mesh.material.color.set("#ffff00"),s.arrowPoints[1]=i;else{if(o){-1!==s.userSelectedDataPoint&&s.compartments[s.userSelectedDataPoint].shadow.mesh.material.color.set("#cccccc"),s.compartments[i].shadow.mesh.material.color.set("#ffff00"),s.dataPointToMove=i,s.updateDisplay(s.compartments[i].dataIndex,s.compartments[i].labelText),s.userSelectedDataPoint=i;break}Object(T.isUndefined)(s.compartments[i])||s.compartments[i].shadow.mesh.material.color.set("#cccccc")}}if(-1===s.dataPointToMove&&s.progressBar){if(s.userSelectedDataPoint=-1,s.animationData&&!this.isDataLoaded())return void alert("Please import data first");if(s.progressBar.withinBar(n.x,n.y)&&s.animationData){var r=s.progressBar.getStep(n.x),h=s.animationData[r-1];this.sceneManager.updateProgressBar(r,h?h[0]:"0"),s.step=r-1,this.applyStep()}}}},{key:"isDataLoaded",value:function(){var t=this.dataContext;return t&&!t.dataLoaded()&&alert("Please import data first"),t.dataLoaded()}},{key:"applyStep",value:function(){var t=this.dataContext.step<0?"0":this.dataContext.animationData[this.dataContext.step][0];this.dataContext.step>=0&&this.sceneManager.colorPoints(),this.sceneManager.updateProgressBar(this.dataContext.step+1,t)}}]),t}(),O=function(){function t(e,a){Object(c.a)(this,t),this.dataContext=e,this.sceneManager=a,this.keyPress=this.keyPress.bind(this),this.bindLocalFunctions(this),this.setupEventListeners(this)}return Object(d.a)(t,[{key:"bindLocalFunctions",value:function(t){t.keyPress=t.keyPress.bind(t),t.moveScene=t.moveScene.bind(t)}},{key:"setupEventListeners",value:function(t){document.addEventListener("keydown",t.keyPress)}},{key:"moveScene",value:function(t,e){this.sceneManager.moveCamera(40*e,40*t),this.sceneManager.update()}},{key:"keyPress",value:function(t){var e=!0;switch(t.code){case"ArrowUp":this.moveScene(-1,0);break;case"ArrowLeft":this.moveScene(0,1);break;case"ArrowRight":this.moveScene(0,-1);break;case"ArrowDown":this.moveScene(1,0);break;default:e=!1}e&&t.preventDefault()}}]),t}(),L=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(p.a)(e).call(this,t))).dataContext=a.props.dataContext,a}return Object(m.a)(e,t),Object(d.a)(e,[{key:"componentDidMount",value:function(){!function(t,e){var a=function(t,e){var a=t.createElement("canvas");return a.width=e.scrollWidth,a.height=e.scrollHeight,e.appendChild(a),a}(document,t);!function(t,e){t.screenDimensions={width:e.width,height:e.height},t.origRadius=40,t.paused=!0,t.stepInc=1,t.color=t.color||[70,156,150,1],t.stepDelay=t.stepDelay||300,t.valueMax=t.valueMax||1,t.fluxMax=t.fluxMax||1,t.skipSteps=t.skipSteps||1,t.radius=t.radius||t.origRadius,t.halfQuantity=t.valueMax/2,t.halfFlux=t.fluxMax/2,t.baseColor=[170,0,255,1],t.radius=t.radius||t.origRadius,t.mouseDown=!1,t.dataPointToMove=-1,t.userSelectedDataPoint=-1,t.progressBar=null,t.editMode=!1,t.arrowMode=0,t.arrowPoints=[],t.fontResource=null}(e,a);var n=new M(a,e);new D(a,e,n),new O(e,n);var s=new j(e,n),i=new S(s);e.registerCallback(function(){!function(t,e,a){a.userSelectedDataPoint=-1,a.skipSteps=a.skipSteps||1,a.stepDelay=a.stepDelay||300,a.valueMax=a.valueMax||1,a.fluxMax=a.fluxMax||1,a.color=a.color||[70,156,150,1],a.radius=a.radius||a.origRadius,a.halfQuantity=a.valueMax/2,a.halfFlux=a.fluxMax/2,e.controls.size=a.radius,e.controls.skipSteps=a.skipSteps,e.controls.valueMax=a.valueMax,e.controls.fluxMax=a.fluxMax,e.controls.stepDelay=a.stepDelay,e.controls.color=a.color,t.updateDisplay()}(i,s,e)}),function t(){requestAnimationFrame(t),n.update()}()}(this.threeRootElement,this.dataContext)}},{key:"render",value:function(){var t=this;return s.a.createElement("div",{className:"canvas",ref:function(e){return t.threeRootElement=e}}," ")}}]),e}(n.Component),F=a(5),E=a(44),A=a.n(E),B=a(42),N=a.n(B),R=a(43),z=a.n(R),U=a(95),W=a.n(U),_=a(96),X=a.n(_),H=function(){function t(){Object(c.a)(this,t)}return Object(d.a)(t,[{key:"processXLSXIntoCSV",value:function(t,e){var a=this,n=new FileReader;n.readAsBinaryString(t),n.onload=function(){var t=a.transformXLXSIntoCsvStrings(n.result);e(a.parseSingleCSV(t[0]))}}},{key:"processPlotsData",value:function(t,e){var a=new FileReader;a.readAsText(t),a.onload=function(){var t=a.result;e(JSON.parse(t))}}},{key:"transformXLXSIntoCsvStrings",value:function(t){var e=a(183),n=[],s=e.read(t,{type:"binary"});return s.SheetNames.forEach(function(t){n.push(e.utils.sheet_to_csv(s.Sheets[t]))}),n}},{key:"parseSingleCSV",value:function(t){var e,a,n=0,s=1;for(a=0;a<t.length;a++)"\n"===(e=t.charAt(a))&&n++;for(e="",a=0;"\n"!==e;)","===(e=t.charAt(a))&&s++,a++;for(this.data=new Array(n),a=0;a<n;a++)this.data[a]=new Array(s);for(a=0;a<this.data.length;a++){var i=t.split("\n");this.data[a]=i[a].split(",")}for(a=1;a<this.data.length;a++)"t"!==this.data[a][0]&&"-"!==this.data[a][1]||this.data.splice(a,1);return this.data}}]),t}(),G=a(97),Q=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(p.a)(e).call(this,t))).title=a.props.title||"Upload file",a.processUpload=a.processUpload.bind(Object(F.a)(Object(F.a)(a))),a.state={callback:a.props.onDone,accept:a.props.accept,plot:a.props.isPlot},a}return Object(m.a)(e,t),Object(d.a)(e,[{key:"hasNoFiles",value:function(t){return 0===t.length}},{key:"processUpload",value:function(t){this.state.plot?this.readPlots(t.target.files,this.state.callback):this.readXLSX(t.target.files,this.state.callback)}},{key:"readPlots",value:function(t,e){var a=e,n=new H;0!==t.length&&n.processPlotsData(t[0],function(t){a(t)})}},{key:"readXLSX",value:function(t,e){var a=e,n=new H;this.hasNoFiles(t)||n.processXLSXIntoCSV(t[0],function(t){a(t)})}},{key:"render",value:function(){var t=this;return s.a.createElement(N.a,null,s.a.createElement(z.a,{htmlFor:this.title,style:{cursor:"pointer"}},this.title,s.a.createElement(X.a,{id:this.title,type:"file",accept:this.accept,onChange:this.processUpload,ref:function(e){t.fileInput=e},style:{display:"none"}})))}}]),e}(a.n(G).a),V=function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"untracked";Object(c.a)(this,t),this.id=e,this.compartments=[],this.labels=[],this.arrows=[],this.step=0,this.fluxMax=1,this.valueMax=1,this.stepDelay=300,this.radius=40,this.color=[70,156,150,1],this.skipSteps=1},J=a(64),q=a.n(J),Y=function(){function t(){Object(c.a)(this,t)}return Object(d.a)(t,[{key:"addNewModelToLocal",value:function(){var t=Object(l.a)(h.a.mark(function t(e){var a,n;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=this.newModelTemplate(e),t.next=3,this.loadModelsFromDefaultContainer();case 3:return(n=t.sent).push(a),t.next=7,this.saveToStore("plots",n,"Failed to add a new model").catch(function(){return a});case 7:return t.abrupt("return",a);case 8:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"saveToStore",value:function(){var t=Object(l.a)(h.a.mark(function t(e,a){var n,s=arguments;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=s.length>2&&void 0!==s[2]?s[2]:"Failed to write to storage",t.prev=1,t.next=4,q.a.setItem(e,"!"+JSON.stringify(a));case 4:t.next=9;break;case 6:t.prev=6,t.t0=t.catch(1),alert(n+String(t.t0));case 9:case"end":return t.stop()}},t,null,[[1,6]])}));return function(e,a){return t.apply(this,arguments)}}()},{key:"fetchFromStore",value:function(){var t=Object(l.a)(h.a.mark(function t(e){var a,n,s=arguments;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=s.length>1&&void 0!==s[1]?s[1]:"Failed to fetch from storage",t.prev=1,t.next=4,q.a.getItem(e);case 4:if(n=t.sent){t.next=7;break}return t.abrupt("return",null);case 7:return t.abrupt("return",JSON.parse(n.substring(1)));case 10:t.prev=10,t.t0=t.catch(1),alert(a+": "+String(t.t0));case 13:case"end":return t.stop()}},t,null,[[1,10]])}));return function(e){return t.apply(this,arguments)}}()},{key:"updateStorage",value:function(){var t=Object(l.a)(h.a.mark(function t(e,a){var n,s,i,o;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadModelsFromDefaultContainer();case 2:for(s in n=t.sent)n.hasOwnProperty(s)&&n[s].name===e&&(i=n[s],o=i.versions.length+1,a.id=e+o,i.versions=[this.newModelVersion(a)]);this.saveToStore("plots",n,"Failed to save the models");case 5:case"end":return t.stop()}},t,this)}));return function(e,a){return t.apply(this,arguments)}}()},{key:"removeFromStorage",value:function(){var t=Object(l.a)(h.a.mark(function t(e){var a,n,s;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadModelsFromDefaultContainer();case 2:for(s in a=t.sent,n=[],a)a.hasOwnProperty(s)&&a[s].name!==e&&n.push(a[s]);this.saveToStore("plots",n,"Failed to save the models");case 6:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"loadFromStorage",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.loadModelsFromDefaultContainer();case 2:return 0===(e=t.sent).length&&(e.push(this.newModelTemplate()),this.saveToStore("plots",e,"Failed to save the models")),t.abrupt("return",e);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"loadModelsFromDefaultContainer",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.fetchFromStore("plots","Failed to Access Memory").catch();case 2:return(e=t.sent)&&e.length||(e=[]),t.abrupt("return",e);case 5:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"writeToLocalStorage",value:function(){var t=Object(l.a)(h.a.mark(function t(e){return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e&&e.length||(e=[]),t.next=3,this.saveToStore("plots",e);case 3:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"newModelTemplate",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Default Storage";return{name:t,versions:[this.newModelVersion(new V(t+".1"))]}}},{key:"newModelVersion",value:function(t){return{plot:t}}}]),t}(),$=(a(190),a(15)),K=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(p.a)(e).call(this,t))).IController=a.props.IController,a.dataContext=a.props.dataContext,a.uploadPoints=a.uploadDataPoints.bind(Object(F.a)(Object(F.a)(a))),a.uploadFlux=a.uploadFluxData.bind(Object(F.a)(Object(F.a)(a))),a.processUpload=a.processUpload.bind(Object(F.a)(Object(F.a)(a))),a}return Object(m.a)(e,t),Object(d.a)(e,[{key:"downloadLocalStorage",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e,a,n,s;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return Object($.toast)("Prepping Download",{position:$.toast.POSITION.TOP_LEFT}),t.t0=JSON,t.next=4,(new Y).loadModelsFromDefaultContainer();case 4:t.t1=t.sent,e=t.t0.stringify.call(t.t0,t.t1),a=new Blob([e],{type:"text/plain"}),n=window.URL.createObjectURL(a),(s=document.createElement("a")).setAttribute("href",n),s.setAttribute("download","plots.json"),document.body.appendChild(s),s.click(),s.remove();case 14:case"end":return t.stop()}},t)}));return function(){return t.apply(this,arguments)}}()},{key:"processUpload",value:function(t){this.readPlots(t.target.files)}},{key:"uploadDataPoints",value:function(t){Object($.toast)("Upload Point Data Complete",{position:$.toast.POSITION.TOP_LEFT}),this.dataContext.injectCompartmentList(t)}},{key:"uploadFluxData",value:function(t){Object($.toast)("Upload Flux Data Complete",{position:$.toast.POSITION.TOP_LEFT}),this.dataContext.injectFluxList(t)}},{key:"uploadModels",value:function(){var t=Object(l.a)(h.a.mark(function t(e){return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e||!window.confirm("Warning! This will replace all of your models with the uploaded models. Continue?")){t.next=5;break}return t.next=3,(new Y).writeToLocalStorage(e);case 3:return window.location.reload(),t.abrupt("return");case 5:Object($.toast)("No Models Uploaded",{position:$.toast.POSITION.TOP_LEFT});case 6:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()},{key:"render",value:function(){var t=function(t){t.preventDefault()};return s.a.createElement(A.a,{inverse:!0,id:"mainNav"},s.a.createElement(A.a.Header,null,s.a.createElement(A.a.Brand,{className:"nav-brand"},s.a.createElement("a",{href:"https://github.com/staujd02/time_machine"},"Compartmental Visualizer"))),s.a.createElement(W.a,{inline:!0},s.a.createElement(Q,{className:"nav-item",onDone:this.uploadPoints,isPlot:!1,accept:".xlsx",onClick:t,title:"Upload Compartment Data"}),s.a.createElement(Q,{className:"nav-item",onDone:this.uploadFlux,isPlot:!1,accept:".xlsx",onClick:t,title:"Upload Flux Data"}),s.a.createElement(Q,{className:"nav-item",onDone:this.uploadModels,isPlot:!0,accept:".json",onClick:t,title:"Upload Models"}),s.a.createElement(N.a,{className:"nav-item"},s.a.createElement(z.a,{htmlFor:"Export Models",style:{cursor:"pointer"},onClick:this.downloadLocalStorage},"Export Models",s.a.createElement($.ToastContainer,{autoClose:1500})))))}}]),e}(n.Component),Z=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(p.a)(e).call(this,t))).dataCapsule=a.props.dataCapsule,a.name=a.dataCapsule.name,a.className=a.props.className,a}return Object(m.a)(e,t),Object(d.a)(e,[{key:"render",value:function(){return s.a.createElement("div",{className:this.className},this.name)}}]),e}(n.Component),tt=a(45),et=a.n(tt),at=function(t){function e(t){var a;Object(c.a)(this,e),a=Object(u.a)(this,Object(p.a)(e).call(this,t));var n=Object(F.a)(Object(F.a)(a));return a.entries=[],a.handleClick=a.handleClick.bind(Object(F.a)(Object(F.a)(a))),a.addToLocal=a.addToLocal.bind(Object(F.a)(Object(F.a)(a))),a.removeFromLocal=a.removeFromLocal.bind(Object(F.a)(Object(F.a)(a))),a.loadSaves=a.loadSaves.bind(Object(F.a)(Object(F.a)(a))),a.createButtonEntry=a.createButtonEntry.bind(Object(F.a)(Object(F.a)(a))),a.createEntryName=a.createEntryName.bind(Object(F.a)(Object(F.a)(a))),a.createGrid=a.createGrid.bind(Object(F.a)(Object(F.a)(a))),a.activeModelName=a.activeModelName.bind(Object(F.a)(Object(F.a)(a))),a.state={dataContext:n.props.dataContext},a.loadSaves(),a}return Object(m.a)(e,t),Object(d.a)(e,[{key:"isActive",value:function(t){return this.state.dataContext.currentPlot().id===t.versions[t.versions.length-1].plot.id}},{key:"applyName",value:function(t){return this.isActive(t)?"Save":"Load"}},{key:"createButtonEntry",value:function(t){var e=this;return s.a.createElement(et.a,{key:this.entries.length,className:"grid-item",onClick:function(){return e.handleClick(t)}},this.applyName(t))}},{key:"createEntryName",value:function(t){return s.a.createElement(Z,{key:this.entries.length,className:"grid-item",dataCapsule:t})}},{key:"activeModelName",value:function(){var t=this,e="";return this.state.models&&this.state.models.forEach(function(a){t.isActive(a)&&(e=a.name)})," "+e}},{key:"addToLocal",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.solictStorageName("you would like to add."))){t.next=7;break}return t.next=4,(new Y).addNewModelToLocal(e);case 4:return t.next=6,this.loadSaves();case 6:this.forceUpdate();case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"removeFromLocal",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=this.solictStorageName("you would like to permanently delete."))){t.next=8;break}return t.next=4,(new Y).removeFromStorage(e);case 4:return t.next=6,this.loadSaves();case 6:this.forceUpdate(),$.toast.success("Model Removed");case 8:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"solictStorageName",value:function(t){return window.prompt("Please enter the name of Model "+t)}},{key:"handleClick",value:function(){var t=Object(l.a)(h.a.mark(function t(e){var a;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isActive(e)){t.next=7;break}return a=this.state.dataContext.currentPlot(),t.next=4,(new Y).updateStorage(e.name,a);case 4:$.toast.success("Model Saved"),t.next=11;break;case 7:return t.next=9,this.loadSaves();case 9:this.state.dataContext.currentPlot(e),this.forceUpdate();case 11:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"loadSaves",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e,a;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return this.entries=[],t.next=3,(new Y).loadFromStorage(this.ThreeController);case 3:e=t.sent,a=this.state.dataContext,this.setState({dataContext:a,models:e});case 6:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"createGrid",value:function(){var t=this;this.state.models&&(this.entries=[],this.state.models.forEach(function(e){t.entries.push(t.createEntryName(e)),t.entries.push(t.createButtonEntry(e))}))}},{key:"render",value:function(){return this.createGrid(),s.a.createElement("div",null,s.a.createElement("h4",{className:"model-list-banner"},"Models"),s.a.createElement("h5",{className:"active-banner"},s.a.createElement("span",null,"Loaded Model: "),this.activeModelName()),s.a.createElement("div",{className:"grid-container"},this.entries),s.a.createElement("div",{className:"grid-container"},s.a.createElement(et.a,{id:"new-plot",onClick:this.addToLocal},"New Model"),s.a.createElement(et.a,{id:"delete-plot",onClick:this.removeFromLocal},"Delete Model")))}}]),e}(n.Component),nt=a(63),st=a.n(nt),it=a(36),ot=a.n(it),rt=a(65),ht=a.n(rt),lt=a(98),ct=a.n(lt),dt=function(){function t(e){Object(c.a)(this,t),this.plot_id=e.id,this.callbacks=[],this.labelMode=!1,this.onLoad=null,this.animationData=null,this.fluxData=null,e.dataPoints&&(e.compartments=e.dataPoints,e.dataPoints=void 0),Object.assign(this,e),this.callObservers=this.callObservers.bind(this),this.registerCallback=this.registerCallback.bind(this),this.currentPlot=this.currentPlot.bind(this),this.currentPlotDetails=this.currentPlotDetails.bind(this),this.loadPlot=this.loadPlot.bind(this),this.injectCompartmentList=this.loadCompartmentData.bind(this),this.injectFluxList=this.loadFluxData.bind(this),this.dataLoaded=this.dataLoaded.bind(this),this.hasNextStep=this.hasNextStep.bind(this)}return Object(d.a)(t,[{key:"dataLoaded",value:function(){return null!=this.animationData}},{key:"hasNextStep",value:function(){return this.dataLoaded()&&this.step<this.animationData.length}},{key:"registerCallback",value:function(t){this.callbacks.push(t)}},{key:"currentPlot",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return t?this.loadPlot(t.versions[t.versions.length-1].plot):this.currentPlotDetails()}},{key:"currentPlotDetails",value:function(){return this.dataPoints&&(this.compartments=this.dataPoints),{id:this.plot_id,compartments:this.compartments,labels:this.labels,arrows:this.arrows,step:this.step,valueMax:this.valueMax,fluxMax:this.fluxMax,stepDelay:this.stepDelay,color:this.color,skipSteps:this.skipSteps,radius:this.radius}}},{key:"callObservers",value:function(){this.callbacks.forEach(function(t){t()})}},{key:"loadFluxData",value:function(t){t.length>1&&isNaN(t[1][1])&&(this.fluxOriginLabels=t[0],this.fluxDestinationLabels=t[1],this.fluxOriginLabels.splice(0,1),this.fluxDestinationLabels.splice(0,1),t.splice(0,1)),t.splice(0,1),this.fluxData=t,this.onLoad&&"function"===typeof this.onLoad&&this.onLoad()}},{key:"loadPlot",value:function(t){return t.dataPoints&&(t.compartments=t.dataPoints),Object.assign(this,t),this.plot_id=t.id,this.callObservers(),t}},{key:"loadCompartmentData",value:function(t){this.labels=t[0],t.splice(0,1),this.animationData=t,this.onLoad&&"function"===typeof this.onLoad&&this.onLoad()}}]),t}(),ut=function(t){function e(t){var a;return Object(c.a)(this,e),(a=Object(u.a)(this,Object(p.a)(e).call(this,t))).ThreeController={resetDataAnimation:function(){},onLoad:function(){},onFluxLoad:function(){}},a.fetchSaves(),a}return Object(m.a)(e,t),Object(d.a)(e,[{key:"fetchSaves",value:function(){var t=Object(l.a)(h.a.mark(function t(){var e,a,n;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(new Y).loadFromStorage(this.ThreeController);case 2:e=t.sent,console.log(e),a=e[0].versions[e[0].versions.length-1].plot,n=new dt(a),this.setState({saves:e,currentPlot:a,currentContext:n});case 7:case"end":return t.stop()}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"render",value:function(){return this.state&&this.state.currentContext?s.a.createElement("div",{className:"app"},s.a.createElement(st.a,{fluid:!0,className:"fill"},s.a.createElement(ot.a,null,s.a.createElement(K,{dataContext:this.state.currentContext,IController:this.ThreeController})),s.a.createElement(ot.a,{className:"fill"},s.a.createElement(ht.a,{sm:2,md:2,className:"sidebar"},s.a.createElement(ot.a,{sm:2,md:2},s.a.createElement("div",{className:"dat-style",id:"datGuiAnchor"})),s.a.createElement(ot.a,{sm:2,md:2},s.a.createElement(at,{dataContext:this.state.currentContext,saves:this.saves})),s.a.createElement(ct.a,{className:"logo",src:"./pfw-white.png"})),s.a.createElement(ht.a,{sm:10,md:10,className:"threeContainer"},s.a.createElement(L,{dataContext:this.state.currentContext,IController:this.ThreeController}))))):s.a.createElement("div",null,"Loading From Storage")}}]),e}(n.Component),pt=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function mt(t){navigator.serviceWorker.register(t).then(function(t){t.onupdatefound=function(){var e=t.installing;e.onstatechange=function(){"installed"===e.state&&(navigator.serviceWorker.controller?console.log("New content is available; please refresh."):console.log("Content is cached for offline use."))}}}).catch(function(t){console.error("Error during service worker registration:",t)})}o.a.render(s.a.createElement(ut,null),document.getElementById("root")),function(){if("serviceWorker"in navigator){if(new URL("/time_machine",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/time_machine","/service-worker.js");pt?(function(t){fetch(t).then(function(e){404===e.status||-1===e.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(t){t.unregister().then(function(){window.location.reload()})}):mt(t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://goo.gl/SC7cgQ")})):mt(t)})}}()},87:function(t,e){},99:function(t,e,a){t.exports=a(201)}},[[99,1,2]]]);
//# sourceMappingURL=main.ffdbdba2.chunk.js.map